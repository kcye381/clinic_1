<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>St. Servatius - Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* CSS Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #1e88e5;
            --primary-dark: #1565c0;
            --primary-light: #e3f2fd;
            --secondary: #43a047;
            --secondary-dark: #2e7d32;
            --secondary-light: #e8f5e9;
            --danger: #e53935;
            --danger-dark: #c62828;
            --warning: #ffb300;
            --warning-dark: #ff8f00;
            --info: #00acc1;
            --dark: #263238;
            --dark-light: #455a64;
            --light: #f5f7fa;
            --gray: #607d8b;
            --gray-light: #e0e0e0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --radius: 8px;
            --transition: all 0.3s ease;
        }

        body {
            background-color: var(--light);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            transition: var(--transition);
        }

        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .visible {
            display: block !important;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            transition: var(--transition);
            text-align: center;
            border: 2px solid transparent;
        }

        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background-color: var(--primary);
            border-color: var(--primary);
        }

        .btn-secondary {
            background-color: var(--secondary);
            border-color: var(--secondary);
        }

        .btn-danger {
            background-color: var(--danger);
            border-color: var(--danger);
        }

        .btn-warning {
            background-color: var(--warning);
            color: var(--dark);
            border-color: var(--warning);
        }

        .btn-info {
            background-color: var(--info);
            border-color: var(--info);
        }

        .btn-success {
            background-color: var(--secondary);
            border-color: var(--secondary);
        }

        .btn-outline {
            background-color: transparent;
            color: var(--primary);
            border-color: var(--primary);
        }

        .btn-outline:hover {
            background-color: var(--primary);
            color: white;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .btn-large {
            padding: 15px 30px;
            font-size: 1.1rem;
        }

        .btn-icon {
            padding: 10px;
            width: 40px;
            height: 40px;
        }

        /* Loading Spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--gray-light);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Admin Login Page */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary-light) 0%, #bbdefb 100%);
            padding: 20px;
        }

        .login-box {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 400px;
            padding: 40px;
            animation: slideIn 0.5s ease-out;
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo h1 {
            font-size: 2rem;
            color: var(--dark);
            margin-bottom: 10px;
        }

        .login-logo h1 span {
            color: var(--primary);
        }

        .login-logo p {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .login-form .form-group {
            margin-bottom: 20px;
        }

        .login-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .login-form input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--gray-light);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .login-form input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.1);
        }

        .login-footer {
            margin-top: 20px;
            text-align: center;
            color: var(--gray);
            font-size: 0.9rem;
        }

        /* Admin Dashboard Layout */
        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .admin-sidebar {
            width: 250px;
            background: var(--dark);
            color: white;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .admin-sidebar-header {
            padding: 25px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }

        .admin-sidebar-header h2 {
            font-size: 1.3rem;
            margin-bottom: 5px;
            color: white;
        }

        .admin-sidebar-header p {
            color: var(--gray-light);
            font-size: 0.9rem;
        }

        .admin-sidebar-nav {
            flex: 1;
            padding: 0 15px;
        }

        .sidebar-section {
            margin-bottom: 25px;
        }

        .sidebar-section h3 {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--gray-light);
            margin-bottom: 15px;
            padding-left: 10px;
        }

        .sidebar-nav-links {
            list-style: none;
        }

        .sidebar-nav-links li {
            margin-bottom: 5px;
        }

        .sidebar-nav-links a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            color: var(--gray-light);
            text-decoration: none;
            border-radius: var(--radius);
            transition: var(--transition);
            font-weight: 500;
        }

        .sidebar-nav-links a:hover,
        .sidebar-nav-links a.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .sidebar-nav-links a i {
            width: 20px;
            font-size: 1.1rem;
        }

        .admin-user-profile {
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: auto;
        }

        .admin-user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .admin-user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            object-fit: cover;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .admin-user-details h4 {
            font-size: 0.95rem;
            margin-bottom: 2px;
        }

        .admin-user-details p {
            font-size: 0.8rem;
            color: var(--gray-light);
        }

        /* Main Content */
        .admin-main-content {
            flex: 1;
            margin-left: 250px;
            padding: 0;
            min-height: 100vh;
            background-color: #f8fafc;
            transition: var(--transition);
        }

        .admin-header {
            background: white;
            padding: 20px 30px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--dark);
            cursor: pointer;
            padding: 5px;
        }

        .header-title h1 {
            font-size: 1.5rem;
            color: var(--dark);
        }

        .header-title p {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .notification-badge {
            position: relative;
        }

        .notification-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--danger);
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }

        .admin-content {
            padding: 30px;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 20px;
            transition: var(--transition);
            border-left: 5px solid var(--primary);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .stat-card.warning {
            border-left-color: var(--warning);
        }

        .stat-card.success {
            border-left-color: var(--secondary);
        }

        .stat-card.danger {
            border-left-color: var(--danger);
        }

        .stat-card.info {
            border-left-color: var(--info);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: var(--radius);
            background: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: var(--primary);
        }

        .stat-card.warning .stat-icon {
            background: #fff3e0;
            color: var(--warning);
        }

        .stat-card.success .stat-icon {
            background: var(--secondary-light);
            color: var(--secondary);
        }

        .stat-card.danger .stat-icon {
            background: #ffebee;
            color: var(--danger);
        }

        .stat-card.info .stat-icon {
            background: #e0f7fa;
            color: var(--info);
        }

        .stat-content h3 {
            font-size: 2rem;
            margin-bottom: 5px;
            color: var(--dark);
        }

        .stat-content p {
            color: var(--gray);
            font-size: 0.95rem;
        }

        .stat-change {
            font-size: 0.85rem;
            margin-top: 5px;
        }

        .stat-change.positive {
            color: var(--secondary);
        }

        .stat-change.negative {
            color: var(--danger);
        }

        /* Charts Section */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .chart-card {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-header h3 {
            font-size: 1.2rem;
            color: var(--dark);
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        /* Tables */
        .data-table-container {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 30px;
        }

        .table-header {
            padding: 20px 25px;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header h3 {
            font-size: 1.2rem;
            color: var(--dark);
        }

        .table-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .search-box {
            position: relative;
            min-width: 250px;
        }

        .search-box input {
            width: 100%;
            padding: 10px 15px 10px 40px;
            border: 1px solid var(--gray-light);
            border-radius: var(--radius);
            font-size: 0.95rem;
            transition: var(--transition);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.1);
        }

        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        .table-responsive {
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .data-table th {
            background-color: var(--primary-light);
            color: var(--dark);
            font-weight: 600;
            text-align: left;
            padding: 15px;
            border-bottom: 2px solid var(--gray-light);
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid var(--gray-light);
        }

        .data-table tbody tr:hover {
            background-color: #f8fafc;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-pending {
            background-color: #fff3e0;
            color: var(--warning-dark);
        }

        .status-confirmed {
            background-color: #e8f5e9;
            color: var(--secondary-dark);
        }

        .status-completed {
            background-color: var(--secondary-light);
            color: var(--secondary-dark);
        }

        .status-cancelled {
            background-color: #ffebee;
            color: var(--danger-dark);
        }

        .status-in-progress {
            background-color: #e0f7fa;
            color: var(--info);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        /* Forms */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--gray-light);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--gray-light);
        }

        /* File Upload Styles */
        .file-upload-container {
            border: 2px dashed var(--gray-light);
            border-radius: var(--radius);
            padding: 40px;
            text-align: center;
            background: var(--light);
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 20px;
        }

        .file-upload-container:hover {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .file-upload-container.dragover {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .file-upload-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .file-upload-text h3 {
            margin-bottom: 10px;
            color: var(--dark);
        }

        .file-upload-text p {
            color: var(--gray);
            margin-bottom: 20px;
        }

        .file-preview {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .file-preview-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .file-preview-image {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: var(--radius);
        }

        .file-preview-info {
            flex: 1;
        }

        .file-preview-info h4 {
            margin-bottom: 5px;
        }

        .file-preview-info p {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .file-preview-actions {
            display: flex;
            gap: 10px;
        }

        .upload-progress {
            width: 100%;
            height: 10px;
            background: var(--gray-light);
            border-radius: 5px;
            overflow: hidden;
            margin-top: 10px;
        }

        .upload-progress-bar {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            animation: fadeIn 0.3s ease-in;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideIn 0.3s ease-out;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray-light);
        }

        .modal-header h2 {
            font-size: 1.5rem;
            color: var(--dark);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--gray);
            cursor: pointer;
            padding: 5px;
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--dark);
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--gray-light);
            margin-bottom: 25px;
        }

        .tab-btn {
            padding: 12px 25px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 500;
            color: var(--gray);
            transition: var(--transition);
        }

        .tab-btn:hover {
            color: var(--dark);
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        /* Filter Panel */
        .filter-panel {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .filter-header h3 {
            font-size: 1.2rem;
            color: var(--dark);
        }

        .filter-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        /* Slideshow Management */
        .slideshow-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .slideshow-card {
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .slideshow-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .slideshow-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
        }

        .slideshow-card-content {
            padding: 20px;
        }

        .slideshow-card-content h4 {
            margin-bottom: 10px;
            font-size: 1.1rem;
            color: var(--dark);
        }

        .slideshow-card-content p {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .slideshow-card-actions {
            display: flex;
            gap: 10px;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            z-index: 10000;
            animation: slideIn 0.3s ease-out;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 400px;
        }

        .toast.success {
            background: var(--secondary);
            color: white;
        }

        .toast.error {
            background: var(--danger);
            color: white;
        }

        .toast.info {
            background: var(--primary);
            color: white;
        }

        .toast.warning {
            background: var(--warning);
            color: var(--dark);
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--gray-light);
        }

        .pagination-btn {
            padding: 8px 16px;
            background: white;
            border: 1px solid var(--gray-light);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .pagination-btn:hover {
            background: var(--primary-light);
            border-color: var(--primary);
        }

        .pagination-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Export Options */
        .export-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slideInLeft {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .admin-sidebar {
                transform: translateX(-100%);
                position: fixed;
                top: 0;
                left: 0;
                height: 100%;
            }

            .admin-sidebar.active {
                transform: translateX(0);
            }

            .admin-main-content {
                margin-left: 0;
            }

            .menu-toggle {
                display: block;
            }

            .admin-content {
                padding: 20px 15px;
            }

            .dashboard-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
            }

            .stat-card {
                padding: 20px;
            }

            .table-header {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }

            .search-box {
                min-width: 100%;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .chart-card {
                padding: 20px;
            }

            .filter-form {
                grid-template-columns: 1fr;
            }

            .modal-content {
                padding: 20px;
                width: 95%;
            }

            .header-right {
                flex-direction: column;
                gap: 10px;
                align-items: flex-end;
            }

            .file-upload-container {
                padding: 20px;
            }

            .file-preview-item {
                flex-direction: column;
                text-align: center;
            }

            .file-preview-actions {
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .stat-card {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }

            .action-buttons {
                flex-direction: column;
                gap: 5px;
            }

            .btn-small {
                padding: 6px 12px;
                font-size: 0.8rem;
            }

            .tabs {
                flex-wrap: wrap;
            }

            .tab-btn {
                flex: 1;
                min-width: 120px;
                padding: 10px;
                font-size: 0.9rem;
            }

            .slideshow-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Print Styles */
        @media print {
            .admin-sidebar,
            .admin-header,
            .table-actions,
            .action-buttons,
            .form-actions {
                display: none !important;
            }

            .admin-main-content {
                margin-left: 0;
                padding: 0;
            }

            .data-table-container {
                box-shadow: none;
                border: 1px solid #ddd;
            }

            .stat-card {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #ddd;
            }

            .chart-card {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }
    </style>
</head>
<body>
    <!-- Admin Login Page -->
    <div id="adminLoginPage" class="login-container">
        <div class="login-box">
            <div class="login-logo">
                <h1>St. <span>Servatius</span></h1>
                <p>Admin Dashboard - Healthcare Management System</p>
            </div>
            
            <form id="adminLoginForm" class="login-form" onsubmit="adminLogin(event)">
                <div class="form-group">
                    <label for="adminUsername">Username</label>
                    <input type="text" id="adminUsername" placeholder="Enter admin username" required>
                </div>
                <div class="form-group">
                    <label for="adminPassword">Password</label>
                    <input type="password" id="adminPassword" placeholder="Enter admin password" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 10px;">
                    <i class="fas fa-sign-in-alt"></i> Login to Admin Dashboard
                </button>
            </form>
            
            <div class="login-footer">
                <p>Â© 2024 St. Servatius Healthcare Services</p>
                <p>Restricted Access - Authorized Personnel Only</p>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard (Hidden by default) -->
    <div id="adminDashboard" class="hidden">
        <div class="admin-container">
            <!-- Sidebar -->
            <aside class="admin-sidebar" id="adminSidebar">
                <div class="admin-sidebar-header">
                    <h2>Admin Dashboard</h2>
                    <p>Healthcare Management</p>
                </div>
                
                <nav class="admin-sidebar-nav">
                    <div class="sidebar-section">
                        <h3>Main</h3>
                        <ul class="sidebar-nav-links">
                            <li><a href="#" class="active" onclick="showSection('dashboard')"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                            <li><a href="#" onclick="showSection('appointments')"><i class="fas fa-calendar-check"></i> Appointments</a></li>
                            <li><a href="#" onclick="showSection('labTests')"><i class="fas fa-flask"></i> Laboratory Tests</a></li>
                            <li><a href="#" onclick="showSection('patients')"><i class="fas fa-users"></i> Patients</a></li>
                        </ul>
                    </div>
                    
                    <div class="sidebar-section">
                        <h3>Management</h3>
                        <ul class="sidebar-nav-links">
                            <li><a href="#" onclick="showSection('doctors')"><i class="fas fa-user-md"></i> Doctors</a></li>
                            <li><a href="#" onclick="showSection('slideshow')"><i class="fas fa-images"></i> Slideshow Images</a></li>
                            <li><a href="#" onclick="showSection('reports')"><i class="fas fa-chart-bar"></i> Reports</a></li>
                        </ul>
                    </div>
                    
                    <div class="sidebar-section">
                        <h3>Settings</h3>
                        <ul class="sidebar-nav-links">
                            <li><a href="#" onclick="showSection('settings')"><i class="fas fa-cog"></i> System Settings</a></li>
                            <li><a href="#" onclick="adminLogout()"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                        </ul>
                    </div>
                </nav>
                
                <div class="admin-user-profile">
                    <div class="admin-user-info">
                        <div class="admin-user-avatar">
                            <span id="adminAvatarInitials">A</span>
                        </div>
                        <div class="admin-user-details">
                            <h4 id="adminUserName">Administrator</h4>
                            <p id="adminUserRole">System Admin</p>
                        </div>
                    </div>
                    <div class="admin-user-stats">
                        <p style="font-size: 0.8rem; color: var(--gray-light);">
                            Last login: <span id="lastLoginTime">Today, 09:30 AM</span>
                        </p>
                    </div>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="admin-main-content">
                <!-- Header -->
                <header class="admin-header">
                    <div class="header-left">
                        <button class="menu-toggle" onclick="toggleSidebar()">
                            <i class="fas fa-bars"></i>
                        </button>
                        <div class="header-title">
                            <h1 id="pageTitle">Dashboard</h1>
                            <p id="pageSubtitle">Healthcare Management System</p>
                        </div>
                    </div>
                    
                    <div class="header-right">
                        <button class="btn btn-icon btn-outline notification-badge" onclick="showNotifications()">
                            <i class="fas fa-bell"></i>
                            <span class="notification-count" id="notificationCount">3</span>
                        </button>
                        <button class="btn btn-primary" onclick="refreshData()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                </header>

                <!-- Dashboard Content -->
                <div class="admin-content">
                    <!-- Dashboard Section -->
                    <section id="dashboardSection" class="section-content active">
                        <!-- Stats Cards -->
                        <div class="dashboard-grid">
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-calendar-check"></i>
                                </div>
                                <div class="stat-content">
                                    <h3 id="totalAppointmentsCount">0</h3>
                                    <p>Total Appointments</p>
                                    <span class="stat-change positive">
                                        <i class="fas fa-arrow-up"></i> 12% from last month
                                    </span>
                                </div>
                            </div>
                            
                            <div class="stat-card warning">
                                <div class="stat-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="stat-content">
                                    <h3 id="pendingAppointmentsCount">0</h3>
                                    <p>Pending Appointments</p>
                                    <span class="stat-change negative">
                                        <i class="fas fa-arrow-down"></i> 5% from yesterday
                                    </span>
                                </div>
                            </div>
                            
                            <div class="stat-card success">
                                <div class="stat-icon">
                                    <i class="fas fa-flask"></i>
                                </div>
                                <div class="stat-content">
                                    <h3 id="completedLabTestsCount">0</h3>
                                    <p>Completed Lab Tests</p>
                                    <span class="stat-change positive">
                                        <i class="fas fa-arrow-up"></i> 18% from last week
                                    </span>
                                </div>
                            </div>
                            
                            <div class="stat-card info">
                                <div class="stat-icon">
                                    <i class="fas fa-user-injured"></i>
                                </div>
                                <div class="stat-content">
                                    <h3 id="totalPatientsCount">0</h3>
                                    <p>Total Patients</p>
                                    <span class="stat-change positive">
                                        <i class="fas fa-arrow-up"></i> 8% from last month
                                    </span>
                                </div>
                            </div>
                        </div>

                        <!-- Charts -->
                        <div class="charts-grid">
                            <div class="chart-card">
                                <div class="chart-header">
                                    <h3>Appointments by Status</h3>
                                    <select id="appointmentsChartPeriod" class="btn-small" onchange="updateAppointmentsChart()">
                                        <option value="week">This Week</option>
                                        <option value="month" selected>This Month</option>
                                        <option value="quarter">This Quarter</option>
                                        <option value="year">This Year</option>
                                    </select>
                                </div>
                                <div class="chart-container">
                                    <canvas id="appointmentsChart"></canvas>
                                </div>
                            </div>
                            
                            <div class="chart-card">
                                <div class="chart-header">
                                    <h3>Lab Tests by Type</h3>
                                    <select id="labTestsChartPeriod" class="btn-small" onchange="updateLabTestsChart()">
                                        <option value="week">This Week</option>
                                        <option value="month" selected>This Month</option>
                                        <option value="quarter">This Quarter</option>
                                        <option value="year">This Year</option>
                                    </select>
                                </div>
                                <div class="chart-container">
                                    <canvas id="labTestsChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Appointments -->
                        <div class="data-table-container">
                            <div class="table-header">
                                <h3>Recent Appointments</h3>
                                <div class="table-actions">
                                    <button class="btn btn-primary btn-small" onclick="showSection('appointments')">
                                        <i class="fas fa-eye"></i> View All
                                    </button>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Patient</th>
                                            <th>Doctor</th>
                                            <th>Date & Time</th>
                                            <th>Type</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recentAppointmentsTable">
                                        <!-- Will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </section>

                    <!-- Appointments Section -->
                    <section id="appointmentsSection" class="section-content hidden">
                        <div class="section-header">
                            <h2 style="margin-bottom: 5px;">Appointment Management</h2>
                            <p style="color: var(--gray); margin-bottom: 25px;">Manage and track all patient appointments</p>
                        </div>

                        <!-- Filter Panel -->
                        <div class="filter-panel">
                            <div class="filter-header">
                                <h3>Filter Appointments</h3>
                                <button class="btn btn-outline btn-small" onclick="resetAppointmentFilters()">
                                    <i class="fas fa-redo"></i> Reset
                                </button>
                            </div>
                            <form class="filter-form" id="appointmentFilterForm">
                                <div class="form-group">
                                    <label>Date Range</label>
                                    <div style="display: flex; gap: 10px;">
                                        <input type="date" id="appointmentDateFrom" class="form-control">
                                        <input type="date" id="appointmentDateTo" class="form-control">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Patient Name</label>
                                    <input type="text" id="appointmentPatientName" placeholder="Search patient...">
                                </div>
                                <div class="form-group">
                                    <label>Doctor</label>
                                    <select id="appointmentDoctorFilter">
                                        <option value="">All Doctors</option>
                                        <!-- Will be populated by JavaScript -->
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Status</label>
                                    <select id="appointmentStatusFilter">
                                        <option value="">All Status</option>
                                        <option value="pending">Pending</option>
                                        <option value="confirmed">Confirmed</option>
                                        <option value="completed">Completed</option>
                                        <option value="cancelled">Cancelled</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Type</label>
                                    <select id="appointmentTypeFilter">
                                        <option value="">All Types</option>
                                        <option value="general">General Consultation</option>
                                        <option value="followup">Follow-up</option>
                                        <option value="lab">Laboratory Test</option>
                                        <option value="emergency">Emergency</option>
                                    </select>
                                </div>
                                <div class="form-group" style="align-self: flex-end;">
                                    <button type="button" class="btn btn-primary" onclick="filterAppointments()">
                                        <i class="fas fa-filter"></i> Apply Filters
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Appointments Table -->
                        <div class="data-table-container">
                            <div class="table-header">
                                <h3>All Appointments</h3>
                                <div class="table-actions">
                                    <div class="search-box">
                                        <i class="fas fa-search"></i>
                                        <input type="text" id="appointmentSearch" placeholder="Search appointments..." onkeyup="searchAppointments()">
                                    </div>
                                    <div class="export-options">
                                        <button class="btn btn-success btn-small" onclick="exportAppointmentsCSV()">
                                            <i class="fas fa-download"></i> CSV
                                        </button>
                                        <button class="btn btn-warning btn-small" onclick="printAppointments()">
                                            <i class="fas fa-print"></i> Print
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Patient</th>
                                            <th>Contact</th>
                                            <th>Doctor</th>
                                            <th>Date</th>
                                            <th>Time</th>
                                            <th>Type</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="allAppointmentsTable">
                                        <!-- Will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                            <div class="pagination" id="appointmentsPagination">
                                <!-- Will be populated by JavaScript -->
                            </div>
                        </div>
                    </section>

                    <!-- Laboratory Tests Section -->
                    <section id="labTestsSection" class="section-content hidden">
                        <div class="section-header">
                            <h2 style="margin-bottom: 5px;">Laboratory Tests Management</h2>
                            <p style="color: var(--gray); margin-bottom: 25px;">Manage and track all laboratory tests</p>
                        </div>

                        <!-- Filter Panel -->
                        <div class="filter-panel">
                            <div class="filter-header">
                                <h3>Filter Lab Tests</h3>
                                <button class="btn btn-primary btn-small" onclick="openAddLabTestModal()">
                                    <i class="fas fa-plus"></i> Add New Test
                                </button>
                            </div>
                            <form class="filter-form" id="labTestFilterForm">
                                <div class="form-group">
                                    <label>Date Range</label>
                                    <div style="display: flex; gap: 10px;">
                                        <input type="date" id="labTestDateFrom" class="form-control">
                                        <input type="date" id="labTestDateTo" class="form-control">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Patient Name</label>
                                    <input type="text" id="labTestPatientName" placeholder="Search patient...">
                                </div>
                                <div class="form-group">
                                    <label>Test Type</label>
                                    <select id="labTestTypeFilter">
                                        <option value="">All Types</option>
                                        <option value="blood">Blood Test</option>
                                        <option value="urine">Urine Test</option>
                                        <option value="xray">X-Ray</option>
                                        <option value="ultrasound">Ultrasound</option>
                                        <option value="ecg">ECG</option>
                                        <option value="hiv">HIV Screening</option>
                                        <option value="biopsy">Biopsy</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Status</label>
                                    <select id="labTestStatusFilter">
                                        <option value="">All Status</option>
                                        <option value="pending">Pending</option>
                                        <option value="in-progress">In Progress</option>
                                        <option value="completed">Completed</option>
                                        <option value="cancelled">Cancelled</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Requesting Doctor</label>
                                    <select id="labTestDoctorFilter">
                                        <option value="">All Doctors</option>
                                        <!-- Will be populated by JavaScript -->
                                    </select>
                                </div>
                                <div class="form-group" style="align-self: flex-end;">
                                    <button type="button" class="btn btn-primary" onclick="filterLabTests()">
                                        <i class="fas fa-filter"></i> Apply Filters
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Lab Tests Table -->
                        <div class="data-table-container">
                            <div class="table-header">
                                <h3>All Laboratory Tests</h3>
                                <div class="table-actions">
                                    <div class="search-box">
                                        <i class="fas fa-search"></i>
                                        <input type="text" id="labTestSearch" placeholder="Search lab tests..." onkeyup="searchLabTests()">
                                    </div>
                                    <div class="export-options">
                                        <button class="btn btn-success btn-small" onclick="exportLabTestsCSV()">
                                            <i class="fas fa-download"></i> CSV
                                        </button>
                                        <button class="btn btn-warning btn-small" onclick="printLabTests()">
                                            <i class="fas fa-print"></i> Print
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Test ID</th>
                                            <th>Patient</th>
                                            <th>Test Type</th>
                                            <th>Requested By</th>
                                            <th>Date</th>
                                            <th>Status</th>
                                            <th>Results</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="allLabTestsTable">
                                        <!-- Will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                            <div class="pagination" id="labTestsPagination">
                                <!-- Will be populated by JavaScript -->
                            </div>
                        </div>
                    </section>

                    <!-- Patient Management Section -->
                    <section id="patientsSection" class="section-content hidden">
                        <div class="section-header">
                            <h2 style="margin-bottom: 5px;">Patient Management</h2>
                            <p style="color: var(--gray); margin-bottom: 25px;">Manage patient information and history</p>
                        </div>

                        <!-- Search and Filters -->
                        <div class="filter-panel">
                            <div class="filter-header">
                                <h3>Search Patients</h3>
                            </div>
                            <form class="filter-form" id="patientSearchForm">
                                <div class="form-group">
                                    <label>Search by Name</label>
                                    <input type="text" id="patientNameSearch" placeholder="Enter patient name...">
                                </div>
                                <div class="form-group">
                                    <label>Search by Email</label>
                                    <input type="email" id="patientEmailSearch" placeholder="Enter patient email...">
                                </div>
                                <div class="form-group">
                                    <label>Search by Phone</label>
                                    <input type="tel" id="patientPhoneSearch" placeholder="Enter phone number...">
                                </div>
                                <div class="form-group" style="align-self: flex-end;">
                                    <button type="button" class="btn btn-primary" onclick="searchPatients()">
                                        <i class="fas fa-search"></i> Search
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Patients Table -->
                        <div class="data-table-container">
                            <div class="table-header">
                                <h3>Patient Records</h3>
                                <div class="table-actions">
                                    <div class="search-box">
                                        <i class="fas fa-search"></i>
                                        <input type="text" id="patientQuickSearch" placeholder="Quick search..." onkeyup="quickSearchPatients()">
                                    </div>
                                    <div class="export-options">
                                        <button class="btn btn-success btn-small" onclick="exportPatientsCSV()">
                                            <i class="fas fa-download"></i> Export CSV
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Email</th>
                                            <th>Phone</th>
                                            <th>Age</th>
                                            <th>Gender</th>
                                            <th>Last Visit</th>
                                            <th>Total Appointments</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="patientsTable">
                                        <!-- Will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                            <div class="pagination" id="patientsPagination">
                                <!-- Will be populated by JavaScript -->
                            </div>
                        </div>
                    </section>

                    <!-- Doctor Management Section -->
                    <section id="doctorsSection" class="section-content hidden">
                        <div class="section-header">
                            <h2 style="margin-bottom: 5px;">Doctor Management</h2>
                            <p style="color: var(--gray); margin-bottom: 25px;">Manage doctor information and schedules</p>
                        </div>

                        <!-- Doctor Controls -->
                        <div class="filter-panel">
                            <div class="filter-header">
                                <h3>Doctors List</h3>
                                <button class="btn btn-primary btn-small" onclick="openAddDoctorModal()">
                                    <i class="fas fa-plus"></i> Add New Doctor
                                </button>
                            </div>
                            <form class="filter-form" id="doctorFilterForm">
                                <div class="form-group">
                                    <label>Search by Name</label>
                                    <input type="text" id="doctorNameSearch" placeholder="Enter doctor name...">
                                </div>
                                <div class="form-group">
                                    <label>Specialty</label>
                                    <select id="doctorSpecialtyFilter">
                                        <option value="">All Specialties</option>
                                        <option value="general">General Medicine</option>
                                        <option value="pediatrics">Pediatrics</option>
                                        <option value="gynecology">Gynecology</option>
                                        <option value="ophthalmology">Ophthalmology</option>
                                        <option value="surgery">Surgery</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Availability</label>
                                    <select id="doctorAvailabilityFilter">
                                        <option value="">All</option>
                                        <option value="available">Available</option>
                                        <option value="unavailable">Unavailable</option>
                                    </select>
                                </div>
                                <div class="form-group" style="align-self: flex-end;">
                                    <button type="button" class="btn btn-primary" onclick="filterDoctors()">
                                        <i class="fas fa-filter"></i> Filter Doctors
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Doctors Table -->
                        <div class="data-table-container">
                            <div class="table-header">
                                <h3>All Doctors</h3>
                                <div class="table-actions">
                                    <div class="search-box">
                                        <i class="fas fa-search"></i>
                                        <input type="text" id="doctorQuickSearch" placeholder="Search doctors..." onkeyup="quickSearchDoctors()">
                                    </div>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Specialty</th>
                                            <th>Contact</th>
                                            <th>Schedule</th>
                                            <th>Available Slots</th>
                                            <th>Status</th>
                                            <th>Statistics</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="doctorsTable">
                                        <!-- Will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </section>

                    <!-- Slideshow Management Section -->
                    <section id="slideshowSection" class="section-content hidden">
                        <div class="section-header">
                            <h2 style="margin-bottom: 5px;">Slideshow Images Management</h2>
                            <p style="color: var(--gray); margin-bottom: 25px;">Upload and manage homepage slideshow images</p>
                        </div>

                        <!-- Tabs for different upload methods -->
                        <div class="tabs">
                            <button class="tab-btn active" onclick="showUploadTab('upload')">Upload Images</button>
                            <button class="tab-btn" onclick="showUploadTab('url')">Add by URL</button>
                            <button class="tab-btn" onclick="showUploadTab('manage')">Manage Images</button>
                        </div>

                        <!-- Upload Tab -->
                        <div id="uploadTab" class="tab-content active">
                            <div class="filter-panel">
                                <div class="filter-header">
                                    <h3>Upload Images from Computer</h3>
                                </div>
                                
                                <!-- File Upload Area -->
                                <div class="file-upload-container" id="fileUploadArea" onclick="document.getElementById('fileInput').click()">
                                    <div class="file-upload-icon">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                    </div>
                                    <div class="file-upload-text">
                                        <h3>Drag & Drop Images Here</h3>
                                        <p>or click to browse files</p>
                                        <p style="font-size: 0.9rem; color: var(--gray);">
                                            Supported formats: JPG, PNG, GIF, WebP<br>
                                            Max file size: 5MB per image
                                        </p>
                                    </div>
                                    <input type="file" id="fileInput" accept="image/*" multiple style="display: none;" onchange="handleFileSelect(event)">
                                </div>

                                <!-- File Preview -->
                                <div id="filePreview" class="file-preview"></div>

                                <!-- Image Details Form -->
                                <form id="uploadForm" class="hidden">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>Image Title</label>
                                            <input type="text" id="imageTitle" placeholder="Enter image title" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Image Description</label>
                                            <textarea id="imageDescription" placeholder="Enter image description" required></textarea>
                                        </div>
                                    </div>
                                    
                                    <!-- Upload Progress -->
                                    <div class="upload-progress hidden" id="uploadProgress">
                                        <div class="upload-progress-bar" id="uploadProgressBar"></div>
                                    </div>
                                    
                                    <div class="form-actions">
                                        <button type="button" class="btn" onclick="cancelUpload()">Cancel</button>
                                        <button type="button" class="btn btn-primary" onclick="processUpload()">
                                            <i class="fas fa-upload"></i> Upload Images
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- URL Tab -->
                        <div id="urlTab" class="tab-content">
                            <div class="filter-panel">
                                <div class="filter-header">
                                    <h3>Add Image by URL</h3>
                                </div>
                                <form id="urlForm" onsubmit="addImageByURL(event)">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>Image URL</label>
                                            <input type="url" id="imageUrl" placeholder="https://example.com/image.jpg" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Title</label>
                                            <input type="text" id="urlImageTitle" placeholder="Enter image title" required>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>Description</label>
                                        <textarea id="urlImageDescription" placeholder="Enter image description" required></textarea>
                                    </div>
                                    <div class="form-actions">
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-plus"></i> Add Image
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Manage Tab -->
                        <div id="manageTab" class="tab-content">
                            <div class="data-table-container">
                                <div class="table-header">
                                    <h3>Current Slideshow Images</h3>
                                    <p style="color: var(--gray); font-size: 0.9rem; margin-top: 5px;">
                                        Total Images: <span id="totalSlideshowImages">0</span>
                                    </p>
                                </div>
                                <div class="slideshow-grid" id="slideshowImagesGrid">
                                    <!-- Will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Reports Section -->
                    <section id="reportsSection" class="section-content hidden">
                        <div class="section-header">
                            <h2 style="margin-bottom: 5px;">Reports & Analytics</h2>
                            <p style="color: var(--gray); margin-bottom: 25px;">Generate and export system reports</p>
                        </div>

                        <!-- Report Generator -->
                        <div class="filter-panel">
                            <div class="filter-header">
                                <h3>Generate Report</h3>
                            </div>
                            <form class="filter-form" id="reportGeneratorForm">
                                <div class="form-group">
                                    <label>Report Type</label>
                                    <select id="reportType" onchange="toggleReportOptions()">
                                        <option value="appointments">Appointments Report</option>
                                        <option value="lab_tests">Laboratory Tests Report</option>
                                        <option value="revenue">Revenue Report</option>
                                        <option value="patients">Patient Statistics</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Date Range</label>
                                    <div style="display: flex; gap: 10px;">
                                        <input type="date" id="reportDateFrom" class="form-control" required>
                                        <input type="date" id="reportDateTo" class="form-control" required>
                                    </div>
                                </div>
                                <div class="form-group" id="reportDoctorFilterContainer">
                                    <label>Doctor (Optional)</label>
                                    <select id="reportDoctorFilter">
                                        <option value="">All Doctors</option>
                                        <!-- Will be populated by JavaScript -->
                                    </select>
                                </div>
                                <div class="form-group" style="align-self: flex-end;">
                                    <button type="button" class="btn btn-primary" onclick="generateReport()">
                                        <i class="fas fa-chart-bar"></i> Generate Report
                                    </button>
                                    <button type="button" class="btn btn-success" onclick="exportReport()" style="display: none;" id="exportReportBtn">
                                        <i class="fas fa-download"></i> Export
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Report Results -->
                        <div class="data-table-container hidden" id="reportResults">
                            <div class="table-header">
                                <h3 id="reportTitle">Report Results</h3>
                                <div class="table-actions">
                                    <button class="btn btn-success btn-small" onclick="exportReportCSV()">
                                        <i class="fas fa-download"></i> CSV
                                    </button>
                                    <button class="btn btn-warning btn-small" onclick="printReport()">
                                        <i class="fas fa-print"></i> Print
                                    </button>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="data-table" id="reportTable">
                                    <!-- Report data will be inserted here -->
                                </table>
                            </div>
                        </div>
                    </section>

                    <!-- Settings Section -->
                    <section id="settingsSection" class="section-content hidden">
                        <div class="section-header">
                            <h2 style="margin-bottom: 5px;">System Settings</h2>
                            <p style="color: var(--gray); margin-bottom: 25px;">Configure system preferences and security</p>
                        </div>

                        <div class="tabs">
                            <button class="tab-btn active" onclick="showSettingsTab('general')">General</button>
                            <button class="tab-btn" onclick="showSettingsTab('security')">Security</button>
                            <button class="tab-btn" onclick="showSettingsTab('notifications')">Notifications</button>
                            <button class="tab-btn" onclick="showSettingsTab('backup')">Backup</button>
                        </div>

                        <!-- General Settings -->
                        <div id="generalSettings" class="tab-content active">
                            <form id="generalSettingsForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Clinic Name</label>
                                        <input type="text" id="clinicName" value="St. Servatius Healthcare Services" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Clinic Hours (Weekdays)</label>
                                        <input type="text" id="clinicHoursWeekdays" value="7:00 AM - 5:00 PM" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Clinic Hours (Sunday)</label>
                                        <input type="text" id="clinicHoursSunday" value="8:00 AM - 12:00 NN" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Contact Phone</label>
                                        <input type="tel" id="clinicPhone" value="0917 102 4624" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Contact Email</label>
                                        <input type="email" id="clinicEmail" value="st.servatius18@gmail.com" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Appointment Slot Duration (minutes)</label>
                                        <input type="number" id="appointmentSlotDuration" value="30" min="15" max="60">
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button type="button" class="btn" onclick="resetGeneralSettings()">Reset</button>
                                    <button type="button" class="btn btn-primary" onclick="saveGeneralSettings()">Save Changes</button>
                                </div>
                            </form>
                        </div>

                        <!-- Security Settings -->
                        <div id="securitySettings" class="tab-content">
                            <form id="securitySettingsForm">
                                <div class="form-group">
                                    <label>Session Timeout (minutes)</label>
                                    <input type="number" id="sessionTimeout" value="30" min="5" max="240">
                                </div>
                                <div class="form-group">
                                    <label>Max Login Attempts</label>
                                    <input type="number" id="maxLoginAttempts" value="5" min="1" max="10">
                                </div>
                                <div class="form-group">
                                    <label>Password Expiry (days)</label>
                                    <input type="number" id="passwordExpiry" value="90" min="30" max="365">
                                </div>
                                <div class="form-actions">
                                    <button type="button" class="btn" onclick="resetSecuritySettings()">Reset</button>
                                    <button type="button" class="btn btn-primary" onclick="saveSecuritySettings()">Save Changes</button>
                                </div>
                            </form>
                        </div>

                        <!-- Notification Settings -->
                        <div id="notificationSettings" class="tab-content">
                            <form id="notificationSettingsForm">
                                <div class="form-group">
                                    <label class="checkbox-label" style="display: flex; align-items: center; gap: 10px;">
                                        <input type="checkbox" id="emailNotifications" checked>
                                        Enable Email Notifications
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label" style="display: flex; align-items: center; gap: 10px;">
                                        <input type="checkbox" id="smsNotifications" checked>
                                        Enable SMS Notifications
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label>Send Reminders Before Appointment (hours)</label>
                                    <input type="number" id="reminderHours" value="24" min="1" max="72">
                                </div>
                                <div class="form-actions">
                                    <button type="button" class="btn" onclick="resetNotificationSettings()">Reset</button>
                                    <button type="button" class="btn btn-primary" onclick="saveNotificationSettings()">Save Changes</button>
                                </div>
                            </form>
                        </div>

                        <!-- Backup Settings -->
                        <div id="backupSettings" class="tab-content">
                            <div class="form-group">
                                <label>Automatic Backup Frequency</label>
                                <select id="backupFrequency">
                                    <option value="daily">Daily</option>
                                    <option value="weekly" selected>Weekly</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Backup Retention Period (days)</label>
                                <input type="number" id="backupRetention" value="30" min="7" max="365">
                            </div>
                            <div class="form-actions">
                                <button type="button" class="btn btn-warning" onclick="createBackup()">
                                    <i class="fas fa-save"></i> Create Backup Now
                                </button>
                                <button type="button" class="btn btn-primary" onclick="saveBackupSettings()">Save Settings</button>
                            </div>
                        </div>
                    </section>
                </div>
            </main>
        </div>
    </div>

    <!-- Modals -->
    
    <!-- View Appointment Modal -->
    <div id="viewAppointmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Appointment Details</h2>
                <button class="modal-close" onclick="closeModal('viewAppointmentModal')">&times;</button>
            </div>
            <div id="appointmentDetailsContent">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Edit Appointment Modal -->
    <div id="editAppointmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Appointment</h2>
                <button class="modal-close" onclick="closeModal('editAppointmentModal')">&times;</button>
            </div>
            <form id="editAppointmentForm" onsubmit="updateAppointment(event)">
                <div id="editAppointmentFormContent">
                    <!-- Will be populated by JavaScript -->
                </div>
                <div class="form-actions">
                    <button type="button" class="btn" onclick="closeModal('editAppointmentModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Appointment</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Lab Test Modal -->
    <div id="addLabTestModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Laboratory Test</h2>
                <button class="modal-close" onclick="closeModal('addLabTestModal')">&times;</button>
            </div>
            <form id="addLabTestForm" onsubmit="saveNewLabTest(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>Patient</label>
                        <select id="labTestPatient" required>
                            <option value="">Select Patient</option>
                            <!-- Will be populated by JavaScript -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Test Type</label>
                        <select id="labTestType" required>
                            <option value="">Select Test Type</option>
                            <option value="blood">Blood Test</option>
                            <option value="urine">Urine Test</option>
                            <option value="xray">X-Ray</option>
                            <option value="ultrasound">Ultrasound</option>
                            <option value="ecg">ECG</option>
                            <option value="hiv">HIV Screening</option>
                            <option value="biopsy">Biopsy</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Requesting Doctor</label>
                        <select id="labTestRequestingDoctor" required>
                            <option value="">Select Doctor</option>
                            <!-- Will be populated by JavaScript -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Test Date</label>
                        <input type="date" id="labTestDate" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Test Notes</label>
                    <textarea id="labTestNotes" rows="3" placeholder="Enter test notes or instructions"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn" onclick="closeModal('addLabTestModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Test</button>
                </div>
            </form>
        </div>
    </div>

    <!-- View Lab Test Modal -->
    <div id="viewLabTestModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Laboratory Test Details</h2>
                <button class="modal-close" onclick="closeModal('viewLabTestModal')">&times;</button>
            </div>
            <div id="labTestDetailsContent">
                <!-- Will be populated by JavaScript -->
            </div>
            <div class="form-actions" id="labTestActions">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Update Lab Test Results Modal -->
    <div id="updateLabTestResultsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Update Test Results</h2>
                <button class="modal-close" onclick="closeModal('updateLabTestResultsModal')">&times;</button>
            </div>
            <form id="updateLabTestResultsForm" onsubmit="saveLabTestResults(event)">
                <div id="updateLabTestResultsContent">
                    <!-- Will be populated by JavaScript -->
                </div>
                <div class="form-actions">
                    <button type="button" class="btn" onclick="closeModal('updateLabTestResultsModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Results</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Doctor Modal -->
    <div id="addDoctorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Doctor</h2>
                <button class="modal-close" onclick="closeModal('addDoctorModal')">&times;</button>
            </div>
            <form id="addDoctorForm" onsubmit="saveNewDoctor(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="doctorFullName" placeholder="Dr. First Last" required>
                    </div>
                    <div class="form-group">
                        <label>Specialty</label>
                        <select id="doctorSpecialty" required>
                            <option value="">Select Specialty</option>
                            <option value="General Medicine">General Medicine</option>
                            <option value="Pediatrics">Pediatrics</option>
                            <option value="Gynecology">Gynecology</option>
                            <option value="Ophthalmology">Ophthalmology</option>
                            <option value="Surgery">Surgery</option>
                            <option value="Cardiology">Cardiology</option>
                            <option value="Dermatology">Dermatology</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="doctorEmail" placeholder="doctor@example.com" required>
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" id="doctorPhone" placeholder="0917-XXX-XXXX" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Weekday Schedule</label>
                        <input type="text" id="doctorWeekdaySchedule" placeholder="7:00 AM - 5:00 PM" required>
                    </div>
                    <div class="form-group">
                        <label>Sunday Schedule</label>
                        <input type="text" id="doctorSundaySchedule" placeholder="8:00 AM - 12:00 NN">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Available Slots per Day</label>
                        <input type="number" id="doctorAvailableSlots" min="1" max="20" value="10" required>
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="doctorStatus" required>
                            <option value="available">Available</option>
                            <option value="unavailable">Unavailable</option>
                            <option value="on-leave">On Leave</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Qualifications</label>
                    <textarea id="doctorQualifications" rows="3" placeholder="Enter doctor qualifications"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn" onclick="closeModal('addDoctorModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Doctor</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Doctor Modal -->
    <div id="editDoctorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Doctor Information</h2>
                <button class="modal-close" onclick="closeModal('editDoctorModal')">&times;</button>
            </div>
            <form id="editDoctorForm" onsubmit="updateDoctor(event)">
                <div id="editDoctorFormContent">
                    <!-- Will be populated by JavaScript -->
                </div>
                <div class="form-actions">
                    <button type="button" class="btn" onclick="closeModal('editDoctorModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Doctor</button>
                </div>
            </form>
        </div>
    </div>

    <!-- View Patient Modal -->
    <div id="viewPatientModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Patient Details</h2>
                <button class="modal-close" onclick="closeModal('viewPatientModal')">&times;</button>
            </div>
            <div id="patientDetailsContent">
                <!-- Will be populated by JavaScript -->
            </div>
            <div class="form-actions">
                <button type="button" class="btn" onclick="closeModal('viewPatientModal')">Close</button>
                <button type="button" class="btn btn-primary" onclick="exportPatientHistory()">Export History</button>
            </div>
        </div>
    </div>

    <!-- Edit Slideshow Image Modal -->
    <div id="editSlideshowImageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Slideshow Image</h2>
                <button class="modal-close" onclick="closeModal('editSlideshowImageModal')">&times;</button>
            </div>
            <form id="editSlideshowImageForm" onsubmit="updateSlideshowImage(event)">
                <div id="editSlideshowImageContent">
                    <!-- Will be populated by JavaScript -->
                </div>
                <div class="form-actions">
                    <button type="button" class="btn" onclick="closeModal('editSlideshowImageModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Image</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Notifications Modal -->
    <div id="notificationsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Notifications</h2>
                <button class="modal-close" onclick="closeModal('notificationsModal')">&times;</button>
            </div>
            <div id="notificationsList">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast hidden"></div>

    <script>
        // Admin Data Storage
        const adminData = {
            currentAdmin: null,
            adminCredentials: JSON.parse(localStorage.getItem('adminCredentials')) || [
                { username: 'admin', password: 'admin123', name: 'Administrator', role: 'System Admin' }
            ],
            
            // Mock Data
            appointments: JSON.parse(localStorage.getItem('adminAppointments')) || [
                { id: 1, patientId: 1, patientName: 'John Doe', patientEmail: 'kcye@gmail.com', patientPhone: '0917-102-4624', 
                  doctorId: 1, doctorName: 'Dr. Rowena Mesa-Nieles', date: '2024-12-10', time: '10:00 AM', 
                  type: 'general', symptoms: 'General checkup', status: 'confirmed' },
                { id: 2, patientId: 2, patientName: 'Jane Smith', patientEmail: 'jane@example.com', patientPhone: '0917-555-1234', 
                  doctorId: 2, doctorName: 'Dr. Rachelle Lirio', date: '2024-12-05', time: '2:00 PM', 
                  type: 'followup', symptoms: 'Child vaccination', status: 'completed' },
                { id: 3, patientId: 3, patientName: 'Bob Johnson', patientEmail: 'bob@example.com', patientPhone: '0917-777-8888', 
                  doctorId: 4, doctorName: 'Dr. Rico Desiree M. Reyes', date: '2024-12-15', time: '11:30 AM', 
                  type: 'lab', symptoms: 'Fever and cough', status: 'pending' },
                { id: 4, patientId: 4, patientName: 'Alice Brown', patientEmail: 'alice@example.com', patientPhone: '0917-999-0000', 
                  doctorId: 3, doctorName: 'Dr. Viola A. Villegas', date: '2024-12-12', time: '9:00 AM', 
                  type: 'emergency', symptoms: 'Severe headache', status: 'cancelled' },
                { id: 5, patientId: 1, patientName: 'John Doe', patientEmail: 'kcye@gmail.com', patientPhone: '0917-102-4624', 
                  doctorId: 1, doctorName: 'Dr. Rowena Mesa-Nieles', date: '2024-12-20', time: '3:00 PM', 
                  type: 'followup', symptoms: 'Blood pressure check', status: 'pending' }
            ],
            
            labTests: JSON.parse(localStorage.getItem('adminLabTests')) || [
                { id: 1, patientId: 1, patientName: 'John Doe', testType: 'blood', requestingDoctor: 'Dr. Rowena Mesa-Nieles',
                  date: '2024-12-10', status: 'completed', results: 'Normal', notes: 'Complete blood count' },
                { id: 2, patientId: 2, patientName: 'Jane Smith', testType: 'xray', requestingDoctor: 'Dr. Rachelle Lirio',
                  date: '2024-12-05', status: 'completed', results: 'Clear', notes: 'Chest X-ray' },
                { id: 3, patientId: 3, patientName: 'Bob Johnson', testType: 'ultrasound', requestingDoctor: 'Dr. Rico Desiree M. Reyes',
                  date: '2024-12-15', status: 'in-progress', results: '', notes: 'Abdominal ultrasound' },
                { id: 4, patientId: 4, patientName: 'Alice Brown', testType: 'ecg', requestingDoctor: 'Dr. Viola A. Villegas',
                  date: '2024-12-12', status: 'pending', results: '', notes: 'Routine ECG' },
                { id: 5, patientId: 1, patientName: 'John Doe', testType: 'hiv', requestingDoctor: 'Dr. Rowena Mesa-Nieles',
                  date: '2024-12-20', status: 'pending', results: '', notes: 'HIV screening' }
            ],
            
            patients: JSON.parse(localStorage.getItem('adminPatients')) || [
                { id: 1, name: 'John Doe', email: 'kcye@gmail.com', phone: '0917-102-4624', 
                  age: 35, gender: 'Male', address: 'Binangonan, Rizal', lastVisit: '2024-12-10' },
                { id: 2, name: 'Jane Smith', email: 'jane@example.com', phone: '0917-555-1234', 
                  age: 28, gender: 'Female', address: 'Binangonan, Rizal', lastVisit: '2024-12-05' },
                { id: 3, name: 'Bob Johnson', email: 'bob@example.com', phone: '0917-777-8888', 
                  age: 45, gender: 'Male', address: 'Binangonan, Rizal', lastVisit: '2024-12-15' },
                { id: 4, name: 'Alice Brown', email: 'alice@example.com', phone: '0917-999-0000', 
                  age: 32, gender: 'Female', address: 'Binangonan, Rizal', lastVisit: '2024-12-12' }
            ],
            
            doctors: JSON.parse(localStorage.getItem('adminDoctors')) || [
                { id: 1, name: 'Dr. Rowena Mesa-Nieles', specialty: 'General Medicine', email: 'rowena@stservatius.com', 
                  phone: '0917-111-1111', weekdaySchedule: '7:00 AM - 5:00 PM', sundaySchedule: '8:00 AM - 12:00 NN',
                  availableSlots: 5, status: 'available', qualifications: 'MD, General Medicine Specialist' },
                { id: 2, name: 'Dr. Rachelle Lirio', specialty: 'Pediatrics', email: 'rachelle@stservatius.com', 
                  phone: '0917-222-2222', weekdaySchedule: '7:00 AM - 5:00 PM', sundaySchedule: '8:00 AM - 12:00 NN',
                  availableSlots: 4, status: 'available', qualifications: 'MD, Pediatrics Specialist' },
                { id: 3, name: 'Dr. Viola A. Villegas', specialty: 'Gynecology', email: 'viola@stservatius.com', 
                  phone: '0917-333-3333', weekdaySchedule: '7:00 AM - 5:00 PM', sundaySchedule: '8:00 AM - 12:00 NN',
                  availableSlots: 3, status: 'available', qualifications: 'MD, Gynecology Specialist' },
                { id: 4, name: 'Dr. Rico Desiree M. Reyes', specialty: 'General Medicine', email: 'rico@stservatius.com', 
                  phone: '0917-444-4444', weekdaySchedule: '7:00 AM - 5:00 PM', sundaySchedule: 'Not Available',
                  availableSlots: 6, status: 'available', qualifications: 'MD, General Medicine' },
                { id: 5, name: 'Dr. Georgina Tubon-Reyes', specialty: 'General Medicine', email: 'georgina@stservatius.com', 
                  phone: '0917-555-5555', weekdaySchedule: '7:00 AM - 5:00 PM', sundaySchedule: 'Not Available',
                  availableSlots: 4, status: 'unavailable', qualifications: 'MD, General Medicine' },
                { id: 6, name: 'Dr. Marjorie Y. Manabat', specialty: 'Ophthalmology', email: 'marjorie@stservatius.com', 
                  phone: '0917-666-6666', weekdaySchedule: '7:00 AM - 5:00 PM', sundaySchedule: '8:00 AM - 12:00 NN',
                  availableSlots: 2, status: 'available', qualifications: 'MD, Ophthalmology Specialist' }
            ],
            
            // Updated slideshow images with local storage support and file upload
            slideshowImages: JSON.parse(localStorage.getItem('adminSlideshowImages')) || [
                { 
                    id: 1, 
                    url: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwMCIgaGVpZ2h0PSI4MDAiIHZpZXdCb3g9IjAgMCAxMjAwIDgwMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjEyMDAiIGhlaWdodD0iODAwIiBmaWxsPSIjMWU4OGU1Ii8+Cjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iNDgiIGZpbGw9IndoaXRlIj5TdC4gU2VydmF0aXVzPC90ZXh0Pgo8dGV4dCB4PSI1MCUiIHk9IjYwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjI0IiBmaWxsPSJ3aGl0ZSI+QWRtaW4gU2xpZGVzaG93IEltYWdlPC90ZXh0Pgo8L3N2Zz4=', 
                    title: 'St. Servatius Healthcare', 
                    description: 'Welcome to our medical facility',
                    type: 'uploaded',
                    filename: 'default-image.svg'
                }
            ],
            
            notifications: JSON.parse(localStorage.getItem('adminNotifications')) || [
                { id: 1, type: 'appointment', message: 'New appointment scheduled for tomorrow', time: '2 hours ago', read: false },
                { id: 2, type: 'lab', message: 'Lab test results are ready for review', time: '1 day ago', read: false },
                { id: 3, type: 'system', message: 'System backup completed successfully', time: '2 days ago', read: false }
            ],
            
            settings: JSON.parse(localStorage.getItem('adminSettings')) || {
                clinicName: 'St. Servatius Healthcare Services',
                clinicHoursWeekdays: '7:00 AM - 5:00 PM',
                clinicHoursSunday: '8:00 AM - 12:00 NN',
                clinicPhone: '0917 102 4624',
                clinicEmail: 'st.servatius18@gmail.com',
                appointmentSlotDuration: 30,
                sessionTimeout: 30,
                maxLoginAttempts: 5,
                passwordExpiry: 90,
                emailNotifications: true,
                smsNotifications: true,
                reminderHours: 24,
                backupFrequency: 'weekly',
                backupRetention: 30
            }
        };

        // File upload state
        const uploadState = {
            selectedFiles: [],
            uploadInProgress: false,
            currentUploadIndex: 0
        };

        // Chart instances
        let appointmentsChart = null;
        let labTestsChart = null;

        // Current state
        let currentSection = 'dashboard';
        let currentPage = {
            appointments: 1,
            labTests: 1,
            patients: 1
        };
        const itemsPerPage = 10;

        // Initialize admin dashboard
        function initAdminDashboard() {
            // Check if admin is logged in
            adminData.currentAdmin = JSON.parse(localStorage.getItem('currentAdmin'));
            
            if (adminData.currentAdmin) {
                showAdminDashboard();
                loadDashboardData();
                updateNotifications();
                setupFileUpload();
            } else {
                showAdminLogin();
            }
            
            // Set today's date as default for date inputs
            const today = new Date().toISOString().split('T')[0];
            const dateInputs = document.querySelectorAll('input[type="date"]');
            dateInputs.forEach(input => {
                if (!input.value) {
                    input.value = today;
                }
            });
            
            // Populate doctor dropdowns
            populateDoctorDropdowns();
            
            // Initialize charts
            initCharts();
        }

        // Setup file upload functionality
        function setupFileUpload() {
            const fileUploadArea = document.getElementById('fileUploadArea');
            const fileInput = document.getElementById('fileInput');
            
            // Drag and drop events
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                fileUploadArea.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            // Highlight drop area
            ['dragenter', 'dragover'].forEach(eventName => {
                fileUploadArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                fileUploadArea.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                fileUploadArea.classList.add('dragover');
            }
            
            function unhighlight() {
                fileUploadArea.classList.remove('dragover');
            }
            
            // Handle drop
            fileUploadArea.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles(files);
            }
            
            // Handle file input change
            fileInput.addEventListener('change', function(e) {
                handleFiles(this.files);
            });
        }

        // Handle file selection
        function handleFileSelect(event) {
            handleFiles(event.target.files);
        }

        function handleFiles(files) {
            uploadState.selectedFiles = [];
            
            // Clear previous preview
            document.getElementById('filePreview').innerHTML = '';
            
            // Validate and process files
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                // Validate file type
                if (!file.type.match('image.*')) {
                    showToast(`File "${file.name}" is not an image`, 'error');
                    continue;
                }
                
                // Validate file size (5MB max)
                if (file.size > 5 * 1024 * 1024) {
                    showToast(`File "${file.name}" is too large (max 5MB)`, 'error');
                    continue;
                }
                
                uploadState.selectedFiles.push(file);
                
                // Create preview
                createFilePreview(file);
            }
            
            if (uploadState.selectedFiles.length > 0) {
                // Show upload form
                document.getElementById('uploadForm').classList.remove('hidden');
                // Auto-fill title and description from first file
                const firstFile = uploadState.selectedFiles[0];
                document.getElementById('imageTitle').value = firstFile.name.replace(/\.[^/.]+$/, "").replace(/[-_]/g, ' ');
                document.getElementById('imageDescription').value = `Uploaded image: ${firstFile.name}`;
                
                showToast(`Selected ${uploadState.selectedFiles.length} image(s)`, 'success');
            }
        }

        function createFilePreview(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const previewContainer = document.getElementById('filePreview');
                const fileSize = formatFileSize(file.size);
                
                const previewItem = document.createElement('div');
                previewItem.className = 'file-preview-item';
                previewItem.innerHTML = `
                    <img src="${e.target.result}" alt="${file.name}" class="file-preview-image">
                    <div class="file-preview-info">
                        <h4>${file.name}</h4>
                        <p>${fileSize} â¢ ${file.type}</p>
                    </div>
                    <div class="file-preview-actions">
                        <button class="btn btn-small btn-danger" onclick="removeFilePreview(this)">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                
                previewContainer.appendChild(previewItem);
            };
            
            reader.readAsDataURL(file);
        }

        function removeFilePreview(button) {
            const previewItem = button.closest('.file-preview-item');
            const img = previewItem.querySelector('img');
            const fileName = img.alt;
            
            // Remove from selected files
            uploadState.selectedFiles = uploadState.selectedFiles.filter(file => file.name !== fileName);
            
            // Remove preview
            previewItem.remove();
            
            if (uploadState.selectedFiles.length === 0) {
                document.getElementById('uploadForm').classList.add('hidden');
            }
            
            showToast(`Removed ${fileName}`, 'info');
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Process upload
        function processUpload() {
            if (uploadState.selectedFiles.length === 0) {
                showToast('No files selected', 'error');
                return;
            }
            
            const title = document.getElementById('imageTitle').value;
            const description = document.getElementById('imageDescription').value;
            
            if (!title || !description) {
                showToast('Please enter title and description', 'error');
                return;
            }
            
            // Show progress bar
            document.getElementById('uploadProgress').classList.remove('hidden');
            const progressBar = document.getElementById('uploadProgressBar');
            progressBar.style.width = '0%';
            
            uploadState.uploadInProgress = true;
            uploadState.currentUploadIndex = 0;
            
            // Disable form
            document.querySelectorAll('#uploadForm input, #uploadForm textarea, #uploadForm button').forEach(el => {
                el.disabled = true;
            });
            
            // Upload files one by one
            uploadNextFile(title, description);
        }

        function uploadNextFile(title, description) {
            if (uploadState.currentUploadIndex >= uploadState.selectedFiles.length) {
                // All files uploaded
                completeUpload();
                return;
            }
            
            const file = uploadState.selectedFiles[uploadState.currentUploadIndex];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                // Create image object
                const newImage = {
                    id: Math.max(...adminData.slideshowImages.map(i => i.id), 0) + 1,
                    url: e.target.result, // Data URL
                    title: uploadState.selectedFiles.length === 1 ? title : `${title} ${uploadState.currentUploadIndex + 1}`,
                    description: uploadState.selectedFiles.length === 1 ? description : `${description} (${uploadState.currentUploadIndex + 1}/${uploadState.selectedFiles.length})`,
                    type: 'uploaded',
                    filename: file.name,
                    size: file.size,
                    uploaded: new Date().toISOString()
                };
                
                // Add to slideshow images
                adminData.slideshowImages.push(newImage);
                
                // Update progress
                uploadState.currentUploadIndex++;
                const progress = (uploadState.currentUploadIndex / uploadState.selectedFiles.length) * 100;
                document.getElementById('uploadProgressBar').style.width = `${progress}%`;
                
                // Upload next file
                setTimeout(() => {
                    uploadNextFile(title, description);
                }, 500);
            };
            
            reader.onerror = function() {
                showToast(`Error reading file: ${file.name}`, 'error');
                uploadState.currentUploadIndex++;
                uploadNextFile(title, description);
            };
            
            reader.readAsDataURL(file);
        }

        function completeUpload() {
            // Save to localStorage
            saveAdminData();
            
            // Update user interface slideshow
            updateUserInterfaceSlideshow();
            
            // Reset form
            document.getElementById('uploadForm').classList.add('hidden');
            document.getElementById('filePreview').innerHTML = '';
            document.getElementById('uploadProgress').classList.add('hidden');
            document.getElementById('imageTitle').value = '';
            document.getElementById('imageDescription').value = '';
            
            // Enable form
            document.querySelectorAll('#uploadForm input, #uploadForm textarea, #uploadForm button').forEach(el => {
                el.disabled = false;
            });
            
            uploadState.selectedFiles = [];
            uploadState.uploadInProgress = false;
            
            // Reload slideshow images
            loadSlideshowImages();
            
            showToast(`Successfully uploaded ${uploadState.currentUploadIndex} image(s)`, 'success');
        }

        function cancelUpload() {
            if (uploadState.uploadInProgress) {
                showToast('Upload cancelled', 'warning');
            }
            
            // Reset everything
            document.getElementById('uploadForm').classList.add('hidden');
            document.getElementById('filePreview').innerHTML = '';
            document.getElementById('uploadProgress').classList.add('hidden');
            document.getElementById('imageTitle').value = '';
            document.getElementById('imageDescription').value = '';
            
            uploadState.selectedFiles = [];
            uploadState.uploadInProgress = false;
            uploadState.currentUploadIndex = 0;
            
            // Enable form
            document.querySelectorAll('#uploadForm input, #uploadForm textarea, #uploadForm button').forEach(el => {
                el.disabled = false;
            });
        }

        // Add image by URL
        function addImageByURL(event) {
            event.preventDefault();
            
            const url = document.getElementById('imageUrl').value;
            const title = document.getElementById('urlImageTitle').value;
            const description = document.getElementById('urlImageDescription').value;
            
            if (!url || !title || !description) {
                showToast('Please fill all fields', 'error');
                return;
            }
            
            // Validate URL
            try {
                new URL(url);
            } catch (e) {
                showToast('Please enter a valid URL', 'error');
                return;
            }
            
            // Create image object
            const newImage = {
                id: Math.max(...adminData.slideshowImages.map(i => i.id), 0) + 1,
                url: url,
                title: title,
                description: description,
                type: 'url',
                added: new Date().toISOString()
            };
            
            // Add to slideshow images
            adminData.slideshowImages.push(newImage);
            saveAdminData();
            
            // Update user interface slideshow
            updateUserInterfaceSlideshow();
            
            // Reset form
            document.getElementById('urlForm').reset();
            
            // Reload slideshow images
            loadSlideshowImages();
            
            showToast('Image added successfully!', 'success');
        }

        // Update user interface slideshow
        function updateUserInterfaceSlideshow() {
            // This function updates the main user interface
            // In a real application, this would push updates to all connected clients
            // For this demo, we'll update localStorage and show a notification
            
            // Save slideshow data to a shared storage location
            const slideshowData = {
                images: adminData.slideshowImages,
                lastUpdated: new Date().toISOString(),
                updatedBy: adminData.currentAdmin?.name || 'Admin'
            };
            
            // Save to localStorage (shared with main website)
            localStorage.setItem('stservatius_slideshow', JSON.stringify(slideshowData));
            
            // Also save to admin storage
            localStorage.setItem('adminSlideshowImages', JSON.stringify(adminData.slideshowImages));
            
            // Show notification
            showToast('Slideshow updated on main website!', 'success');
        }

        // Load slideshow images
        function loadSlideshowImages() {
            const container = document.getElementById('slideshowImagesGrid');
            document.getElementById('totalSlideshowImages').textContent = adminData.slideshowImages.length;
            
            container.innerHTML = adminData.slideshowImages.map(image => `
                <div class="slideshow-card">
                    <img src="${image.url}" alt="${image.title}" 
                         onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDMwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjZTVlNWU1Ii8+Cjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTYiIGZpbGw9IiM2MDdkOGIiPkltYWdlIE5vdCBGb3VuZDwvdGV4dD4KPC9zdmc+'">
                    <div class="slideshow-card-content">
                        <h4>${image.title}</h4>
                        <p>${image.description}</p>
                        <div style="font-size: 0.8rem; color: var(--gray); margin-bottom: 10px;">
                            ${image.type === 'uploaded' ? 
                                `<i class="fas fa-upload"></i> Uploaded` : 
                                `<i class="fas fa-link"></i> URL`}
                            ${image.filename ? ` â¢ ${image.filename}` : ''}
                            ${image.size ? ` â¢ ${formatFileSize(image.size)}` : ''}
                        </div>
                        <div class="slideshow-card-actions">
                            <button class="btn btn-small btn-primary" onclick="editSlideshowImage(${image.id})">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-small btn-danger" onclick="deleteSlideshowImage(${image.id})">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                            <button class="btn btn-small btn-success" onclick="setAsFeatured(${image.id})">
                                <i class="fas fa-star"></i> Feature
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Show upload tab
        function showUploadTab(tab) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(el => {
                el.classList.remove('active');
            });
            
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.target.classList.add('active');
            
            // Show selected tab
            document.getElementById(`${tab}Tab`).classList.add('active');
            
            // If showing manage tab, reload images
            if (tab === 'manage') {
                loadSlideshowImages();
            }
        }

        // Admin authentication
        function adminLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;
            
            const admin = adminData.adminCredentials.find(a => 
                a.username === username && a.password === password
            );
            
            if (admin) {
                adminData.currentAdmin = admin;
                localStorage.setItem('currentAdmin', JSON.stringify(admin));
                showAdminDashboard();
                loadDashboardData();
                updateNotifications();
                setupFileUpload();
                showToast('Login successful!', 'success');
            } else {
                showToast('Invalid username or password', 'error');
            }
        }

        function adminLogout() {
            if (confirm('Are you sure you want to logout?')) {
                adminData.currentAdmin = null;
                localStorage.removeItem('currentAdmin');
                showAdminLogin();
                showToast('Logged out successfully', 'info');
            }
        }

        // Navigation
        function showAdminLogin() {
            document.getElementById('adminLoginPage').classList.remove('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
        }

        function showAdminDashboard() {
            document.getElementById('adminLoginPage').classList.add('hidden');
            document.getElementById('adminDashboard').classList.remove('hidden');
            
            // Update admin info
            if (adminData.currentAdmin) {
                document.getElementById('adminUserName').textContent = adminData.currentAdmin.name;
                document.getElementById('adminUserRole').textContent = adminData.currentAdmin.role;
                document.getElementById('adminAvatarInitials').textContent = 
                    adminData.currentAdmin.name.charAt(0).toUpperCase();
                
                // Update last login time
                const now = new Date();
                document.getElementById('lastLoginTime').textContent = 
                    `Today, ${now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}`;
            }
        }

        function showSection(section) {
            // Hide all sections
            document.querySelectorAll('.section-content').forEach(el => {
                el.classList.remove('active');
                el.classList.add('hidden');
            });
            
            // Update active nav link
            document.querySelectorAll('.sidebar-nav-links a').forEach(link => {
                link.classList.remove('active');
            });
            
            event.target.classList.add('active');
            
            // Show selected section
            document.getElementById(`${section}Section`).classList.remove('hidden');
            document.getElementById(`${section}Section`).classList.add('active');
            
            // Update page title
            currentSection = section;
            updatePageTitle(section);
            
            // Load section data
            switch(section) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'appointments':
                    loadAppointmentsData();
                    break;
                case 'labTests':
                    loadLabTestsData();
                    break;
                case 'patients':
                    loadPatientsData();
                    break;
                case 'doctors':
                    loadDoctorsData();
                    break;
                case 'slideshow':
                    showUploadTab('upload');
                    break;
                case 'reports':
                    // Already loaded
                    break;
                case 'settings':
                    loadSettings();
                    break;
            }
        }

        function updatePageTitle(section) {
            const titles = {
                dashboard: 'Dashboard',
                appointments: 'Appointment Management',
                labTests: 'Laboratory Tests Management',
                patients: 'Patient Management',
                doctors: 'Doctor Management',
                slideshow: 'Slideshow Images Management',
                reports: 'Reports & Analytics',
                settings: 'System Settings'
            };
            
            const subtitles = {
                dashboard: 'Healthcare Management System',
                appointments: 'Manage and track all patient appointments',
                labTests: 'Manage and track all laboratory tests',
                patients: 'Manage patient information and history',
                doctors: 'Manage doctor information and schedules',
                slideshow: 'Upload and manage homepage slideshow images',
                reports: 'Generate and export system reports',
                settings: 'Configure system preferences and security'
            };
            
            document.getElementById('pageTitle').textContent = titles[section] || 'Dashboard';
            document.getElementById('pageSubtitle').textContent = subtitles[section] || 'Healthcare Management System';
        }

        // Toggle sidebar on mobile
        function toggleSidebar() {
            document.getElementById('adminSidebar').classList.toggle('active');
        }

        // Dashboard functions
        function loadDashboardData() {
            // Update stats
            updateDashboardStats();
            
            // Load recent appointments
            loadRecentAppointments();
            
            // Update charts
            updateAppointmentsChart();
            updateLabTestsChart();
        }

        function updateDashboardStats() {
            // Calculate statistics
            const totalAppointments = adminData.appointments.length;
            const pendingAppointments = adminData.appointments.filter(a => a.status === 'pending').length;
            const completedLabTests = adminData.labTests.filter(t => t.status === 'completed').length;
            const totalPatients = adminData.patients.length;
            
            // Update UI
            document.getElementById('totalAppointmentsCount').textContent = totalAppointments;
            document.getElementById('pendingAppointmentsCount').textContent = pendingAppointments;
            document.getElementById('completedLabTestsCount').textContent = completedLabTests;
            document.getElementById('totalPatientsCount').textContent = totalPatients;
        }

        function loadRecentAppointments() {
            const container = document.getElementById('recentAppointmentsTable');
            const recentAppointments = adminData.appointments
                .sort((a, b) => new Date(b.date + ' ' + b.time) - new Date(a.date + ' ' + a.time))
                .slice(0, 5);
            
            container.innerHTML = recentAppointments.map(appointment => `
                <tr>
                    <td>#${appointment.id.toString().padStart(3, '0')}</td>
                    <td><strong>${appointment.patientName}</strong></td>
                    <td>${appointment.doctorName}</td>
                    <td>${formatDate(appointment.date)} at ${appointment.time}</td>
                    <td>${appointment.type}</td>
                    <td><span class="status-badge status-${appointment.status}">${appointment.status}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-small btn-outline" onclick="viewAppointment(${appointment.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-small btn-primary" onclick="editAppointment(${appointment.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Chart functions
        function initCharts() {
            // Appointments chart
            const appointmentsCtx = document.getElementById('appointmentsChart').getContext('2d');
            appointmentsChart = new Chart(appointmentsCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Pending', 'Confirmed', 'Completed', 'Cancelled'],
                    datasets: [{
                        data: [0, 0, 0, 0],
                        backgroundColor: [
                            '#ffb300',
                            '#1e88e5',
                            '#43a047',
                            '#e53935'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // Lab tests chart
            const labTestsCtx = document.getElementById('labTestsChart').getContext('2d');
            labTestsChart = new Chart(labTestsCtx, {
                type: 'bar',
                data: {
                    labels: ['Blood', 'Urine', 'X-Ray', 'Ultrasound', 'ECG', 'HIV', 'Biopsy'],
                    datasets: [{
                        label: 'Tests Completed',
                        data: [0, 0, 0, 0, 0, 0, 0],
                        backgroundColor: '#43a047',
                        borderColor: '#2e7d32',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        function updateAppointmentsChart() {
            const period = document.getElementById('appointmentsChartPeriod').value;
            
            // Filter appointments by period
            let filteredAppointments = adminData.appointments;
            if (period !== 'year') {
                const now = new Date();
                filteredAppointments = adminData.appointments.filter(appointment => {
                    const appDate = new Date(appointment.date);
                    switch(period) {
                        case 'week':
                            const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                            return appDate >= weekAgo;
                        case 'month':
                            return appDate.getMonth() === now.getMonth() && appDate.getFullYear() === now.getFullYear();
                        case 'quarter':
                            const quarter = Math.floor(now.getMonth() / 3);
                            const appQuarter = Math.floor(appDate.getMonth() / 3);
                            return appQuarter === quarter && appDate.getFullYear() === now.getFullYear();
                        default:
                            return true;
                    }
                });
            }
            
            // Count by status
            const counts = {
                pending: filteredAppointments.filter(a => a.status === 'pending').length,
                confirmed: filteredAppointments.filter(a => a.status === 'confirmed').length,
                completed: filteredAppointments.filter(a => a.status === 'completed').length,
                cancelled: filteredAppointments.filter(a => a.status === 'cancelled').length
            };
            
            // Update chart
            appointmentsChart.data.datasets[0].data = [
                counts.pending,
                counts.confirmed,
                counts.completed,
                counts.cancelled
            ];
            appointmentsChart.update();
        }

        function updateLabTestsChart() {
            const period = document.getElementById('labTestsChartPeriod').value;
            
            // Filter lab tests by period
            let filteredTests = adminData.labTests;
            if (period !== 'year') {
                const now = new Date();
                filteredTests = adminData.labTests.filter(test => {
                    const testDate = new Date(test.date);
                    switch(period) {
                        case 'week':
                            const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                            return testDate >= weekAgo;
                        case 'month':
                            return testDate.getMonth() === now.getMonth() && testDate.getFullYear() === now.getFullYear();
                        case 'quarter':
                            const quarter = Math.floor(now.getMonth() / 3);
                            const testQuarter = Math.floor(testDate.getMonth() / 3);
                            return testQuarter === quarter && testDate.getFullYear() === now.getFullYear();
                        default:
                            return true;
                    }
                });
            }
            
            // Count by type (only completed tests)
            const completedTests = filteredTests.filter(t => t.status === 'completed');
            const typeCounts = {
                blood: completedTests.filter(t => t.testType === 'blood').length,
                urine: completedTests.filter(t => t.testType === 'urine').length,
                xray: completedTests.filter(t => t.testType === 'xray').length,
                ultrasound: completedTests.filter(t => t.testType === 'ultrasound').length,
                ecg: completedTests.filter(t => t.testType === 'ecg').length,
                hiv: completedTests.filter(t => t.testType === 'hiv').length,
                biopsy: completedTests.filter(t => t.testType === 'biopsy').length
            };
            
            // Update chart
            labTestsChart.data.datasets[0].data = [
                typeCounts.blood,
                typeCounts.urine,
                typeCounts.xray,
                typeCounts.ultrasound,
                typeCounts.ecg,
                typeCounts.hiv,
                typeCounts.biopsy
            ];
            labTestsChart.update();
        }

        // Appointment Management
        function loadAppointmentsData() {
            populateAppointmentsTable();
            populateAppointmentFilters();
        }

        function populateAppointmentsTable(page = 1) {
            const container = document.getElementById('allAppointmentsTable');
            const pagination = document.getElementById('appointmentsPagination');
            
            // Get filtered appointments
            const filteredAppointments = filterAppointmentsData();
            
            // Calculate pagination
            const totalPages = Math.ceil(filteredAppointments.length / itemsPerPage);
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageAppointments = filteredAppointments.slice(startIndex, endIndex);
            
            // Update table
            container.innerHTML = pageAppointments.map(appointment => `
                <tr>
                    <td>#${appointment.id.toString().padStart(3, '0')}</td>
                    <td>
                        <strong>${appointment.patientName}</strong><br>
                        <small style="color: var(--gray);">${appointment.patientEmail}</small>
                    </td>
                    <td>${appointment.patientPhone}</td>
                    <td>${appointment.doctorName}</td>
                    <td>${formatDate(appointment.date)}</td>
                    <td>${appointment.time}</td>
                    <td>${appointment.type}</td>
                    <td><span class="status-badge status-${appointment.status}">${appointment.status}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-small btn-outline" onclick="viewAppointment(${appointment.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-small btn-primary" onclick="editAppointment(${appointment.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-small btn-danger" onclick="deleteAppointment(${appointment.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
            
            // Update pagination
            updatePagination(pagination, page, totalPages, 'appointments');
        }

        function filterAppointmentsData() {
            const dateFrom = document.getElementById('appointmentDateFrom').value;
            const dateTo = document.getElementById('appointmentDateTo').value;
            const patientName = document.getElementById('appointmentPatientName').value.toLowerCase();
            const doctorId = document.getElementById('appointmentDoctorFilter').value;
            const status = document.getElementById('appointmentStatusFilter').value;
            const type = document.getElementById('appointmentTypeFilter').value;
            
            return adminData.appointments.filter(appointment => {
                // Date range filter
                if (dateFrom && new Date(appointment.date) < new Date(dateFrom)) return false;
                if (dateTo && new Date(appointment.date) > new Date(dateTo)) return false;
                
                // Patient name filter
                if (patientName && !appointment.patientName.toLowerCase().includes(patientName)) return false;
                
                // Doctor filter
                if (doctorId && appointment.doctorId !== parseInt(doctorId)) return false;
                
                // Status filter
                if (status && appointment.status !== status) return false;
                
                // Type filter
                if (type && appointment.type !== type) return false;
                
                return true;
            });
        }

        function filterAppointments() {
            currentPage.appointments = 1;
            populateAppointmentsTable(1);
        }

        function resetAppointmentFilters() {
            document.getElementById('appointmentFilterForm').reset();
            filterAppointments();
        }

        function searchAppointments() {
            const searchTerm = document.getElementById('appointmentSearch').value.toLowerCase();
            
            if (!searchTerm) {
                filterAppointments();
                return;
            }
            
            const filteredAppointments = adminData.appointments.filter(appointment => 
                appointment.patientName.toLowerCase().includes(searchTerm) ||
                appointment.patientEmail.toLowerCase().includes(searchTerm) ||
                appointment.patientPhone.includes(searchTerm) ||
                appointment.doctorName.toLowerCase().includes(searchTerm)
            );
            
            const container = document.getElementById('allAppointmentsTable');
            container.innerHTML = filteredAppointments.map(appointment => `
                <tr>
                    <td>#${appointment.id.toString().padStart(3, '0')}</td>
                    <td>
                        <strong>${appointment.patientName}</strong><br>
                        <small style="color: var(--gray);">${appointment.patientEmail}</small>
                    </td>
                    <td>${appointment.patientPhone}</td>
                    <td>${appointment.doctorName}</td>
                    <td>${formatDate(appointment.date)}</td>
                    <td>${appointment.time}</td>
                    <td>${appointment.type}</td>
                    <td><span class="status-badge status-${appointment.status}">${appointment.status}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-small btn-outline" onclick="viewAppointment(${appointment.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-small btn-primary" onclick="editAppointment(${appointment.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-small btn-danger" onclick="deleteAppointment(${appointment.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
            
            // Hide pagination for search results
            document.getElementById('appointmentsPagination').innerHTML = '';
        }

        function viewAppointment(id) {
            const appointment = adminData.appointments.find(a => a.id === id);
            if (!appointment) return;
            
            const content = document.getElementById('appointmentDetailsContent');
            content.innerHTML = `
                <div style="display: grid; gap: 20px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div>
                            <label style="display: block; color: var(--gray); font-size: 0.9rem; margin-bottom: 5px;">Patient</label>
                            <p style="font-weight: 600; font-size: 1.1rem;">${appointment.patientName}</p>
                        </div>
                        <div>
                            <label style="display: block; color: var(--gray); font-size: 0.9rem; margin-bottom: 5px;">Contact</label>
                            <p>${appointment.patientPhone}<br>${appointment.patientEmail}</p>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div>
                            <label style="display: block; color: var(--gray); font-size: 0.9rem; margin-bottom: 5px;">Doctor</label>
                            <p style="font-weight: 600;">${appointment.doctorName}</p>
                        </div>
                        <div>
                            <label style="display: block; color: var(--gray); font-size: 0.9rem; margin-bottom: 5px;">Date & Time</label>
                            <p>${formatDate(appointment.date)} at ${appointment.time}</p>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div>
                            <label style="display: block; color: var(--gray); font-size: 0.9rem; margin-bottom: 5px;">Appointment Type</label>
                            <p>${appointment.type}</p>
                        </div>
                        <div>
                            <label style="display: block; color: var(--gray); font-size: 0.9rem; margin-bottom: 5px;">Status</label>
                            <span class="status-badge status-${appointment.status}">${appointment.status}</span>
                        </div>
                    </div>
                    
                    <div>
                        <label style="display: block; color: var(--gray); font-size: 0.9rem; margin-bottom: 5px;">Symptoms / Reason</label>
                        <p>${appointment.symptoms || 'Not specified'}</p>
                    </div>
                </div>
            `;
            
            openModal('viewAppointmentModal');
        }

        function editAppointment(id) {
            const appointment = adminData.appointments.find(a => a.id === id);
            if (!appointment) return;
            
            const content = document.getElementById('editAppointmentFormContent');
            content.innerHTML = `
                <input type="hidden" id="editAppointmentId" value="${appointment.id}">
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Patient</label>
                        <input type="text" value="${appointment.patientName}" readonly>
                    </div>
                    <div class="form-group">
                        <label>Doctor</label>
                        <select id="editAppointmentDoctor" required>
                            ${adminData.doctors.map(doctor => `
                                <option value="${doctor.id}" ${doctor.id === appointment.doctorId ? 'selected' : ''}>
                                    ${doctor.name} - ${doctor.specialty}
                                </option>
                            `).join('')}
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="editAppointmentDate" value="${appointment.date}" required>
                    </div>
                    <div class="form-group">
                        <label>Time</label>
                        <input type="time" id="editAppointmentTime" value="${appointment.time.replace(' AM', '').replace(' PM', '')}" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Type</label>
                        <select id="editAppointmentType" required>
                            <option value="general" ${appointment.type === 'general' ? 'selected' : ''}>General Consultation</option>
                            <option value="followup" ${appointment.type === 'followup' ? 'selected' : ''}>Follow-up</option>
                            <option value="lab" ${appointment.type === 'lab' ? 'selected' : ''}>Laboratory Test</option>
                            <option value="emergency" ${appointment.type === 'emergency' ? 'selected' : ''}>Emergency</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="editAppointmentStatus" required>
                            <option value="pending" ${appointment.status === 'pending' ? 'selected' : ''}>Pending</option>
                            <option value="confirmed" ${appointment.status === 'confirmed' ? 'selected' : ''}>Confirmed</option>
                            <option value="completed" ${appointment.status === 'completed' ? 'selected' : ''}>Completed</option>
                            <option value="cancelled" ${appointment.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Symptoms / Reason</label>
                    <textarea id="editAppointmentSymptoms" rows="3">${appointment.symptoms || ''}</textarea>
                </div>
            `;
            
            openModal('editAppointmentModal');
        }

        function updateAppointment(event) {
            event.preventDefault();
            
            const id = parseInt(document.getElementById('editAppointmentId').value);
            const appointmentIndex = adminData.appointments.findIndex(a => a.id === id);
            
            if (appointmentIndex === -1) return;
            
            const doctorId = parseInt(document.getElementById('editAppointmentDoctor').value);
            const doctor = adminData.doctors.find(d => d.id === doctorId);
            
            adminData.appointments[appointmentIndex] = {
                ...adminData.appointments[appointmentIndex],
                doctorId: doctorId,
                doctorName: doctor.name,
                date: document.getElementById('editAppointmentDate').value,
                time: document.getElementById('editAppointmentTime').value,
                type: document.getElementById('editAppointmentType').value,
                status: document.getElementById('editAppointmentStatus').value,
                symptoms: document.getElementById('editAppointmentSymptoms').value
            };
            
            saveAdminData();
            populateAppointmentsTable(currentPage.appointments);
            loadDashboardData();
            closeModal('editAppointmentModal');
            showToast('Appointment updated successfully!', 'success');
        }

        function deleteAppointment(id) {
            if (confirm('Are you sure you want to delete this appointment?')) {
                adminData.appointments = adminData.appointments.filter(a => a.id !== id);
                saveAdminData();
                populateAppointmentsTable(currentPage.appointments);
                loadDashboardData();
                showToast('Appointment deleted successfully!', 'success');
            }
        }

        // Laboratory Tests Management
        function loadLabTestsData() {
            populateLabTestsTable();
            populateLabTestFilters();
        }

        function populateLabTestsTable(page = 1) {
            const container = document.getElementById('allLabTestsTable');
            const pagination = document.getElementById('labTestsPagination');
            
            // Get filtered lab tests
            const filteredTests = filterLabTestsData();
            
            // Calculate pagination
            const totalPages = Math.ceil(filteredTests.length / itemsPerPage);
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageTests = filteredTests.slice(startIndex, endIndex);
            
            // Update table
            container.innerHTML = pageTests.map(test => `
                <tr>
                    <td>#${test.id.toString().padStart(3, '0')}</td>
                    <td>
                        <strong>${test.patientName}</strong>
                    </td>
                    <td>${test.testType}</td>
                    <td>${test.requestingDoctor}</td>
                    <td>${formatDate(test.date)}</td>
                    <td><span class="status-badge status-${test.status}">${test.status}</span></td>
                    <td>${test.results || 'Pending'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-small btn-outline" onclick="viewLabTest(${test.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-small btn-primary" onclick="updateLabTestStatus(${test.id})" ${test.status === 'completed' ? 'disabled' : ''}>
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
            
            // Update pagination
            updatePagination(pagination, page, totalPages, 'labTests');
        }

        function filterLabTestsData() {
            const dateFrom = document.getElementById('labTestDateFrom').value;
            const dateTo = document.getElementById('labTestDateTo').value;
            const patientName = document.getElementById('labTestPatientName').value.toLowerCase();
            const testType = document.getElementById('labTestTypeFilter').value;
            const status = document.getElementById('labTestStatusFilter').value;
            const doctorId = document.getElementById('labTestDoctorFilter').value;
            
            return adminData.labTests.filter(test => {
                // Date range filter
                if (dateFrom && new Date(test.date) < new Date(dateFrom)) return false;
                if (dateTo && new Date(test.date) > new Date(dateTo)) return false;
                
                // Patient name filter
                if (patientName && !test.patientName.toLowerCase().includes(patientName)) return false;
                
                // Test type filter
                if (testType && test.testType !== testType) return false;
                
                // Status filter
                if (status && test.status !== status) return false;
                
                // Doctor filter (simplified - using doctor name)
                if (doctorId && !test.requestingDoctor.includes(adminData.doctors.find(d => d.id === parseInt(doctorId))?.name || '')) return false;
                
                return true;
            });
        }

        function filterLabTests() {
            currentPage.labTests = 1;
            populateLabTestsTable(1);
        }

        function searchLabTests() {
            const searchTerm = document.getElementById('labTestSearch').value.toLowerCase();
            
            if (!searchTerm) {
                filterLabTests();
                return;
            }
            
            const filteredTests = adminData.labTests.filter(test => 
                test.patientName.toLowerCase().includes(searchTerm) ||
                test.testType.toLowerCase().includes(searchTerm) ||
                test.requestingDoctor.toLowerCase().includes(searchTerm)
            );
            
            const container = document.getElementById('allLabTestsTable');
            container.innerHTML = filteredTests.map(test => `
                <tr>
                    <td>#${test.id.toString().padStart(3, '0')}</td>
                    <td>
                        <strong>${test.patientName}</strong>
                    </td>
                    <td>${test.testType}</td>
                    <td>${test.requestingDoctor}</td>
                    <td>${formatDate(test.date)}</td>
                    <td><span class="status-badge status-${test.status}">${test.status}</span></td>
                    <td>${test.results || 'Pending'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-small btn-outline" onclick="viewLabTest(${test.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-small btn-primary" onclick="updateLabTestStatus(${test.id})" ${test.status === 'completed' ? 'disabled' : ''}>
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
            
            // Hide pagination for search results
            document.getElementById('labTestsPagination').innerHTML = '';
        }

        function openAddLabTestModal() {
            // Populate patient dropdown
            const patientSelect = document.getElementById('labTestPatient');
            patientSelect.innerHTML = '<option value="">Select Patient</option>' +
                adminData.patients.map(patient => `
                    <option value="${patient.id}">${patient.name} (${patient.email})</option>
                `).join('');
            
            // Populate doctor dropdown
            const doctorSelect = document.getElementById('labTestRequestingDoctor');
            doctorSelect.innerHTML = '<option value="">Select Doctor</option>' +
                adminData.doctors.map(doctor => `
                    <option value="${doctor.id}">${doctor.name} - ${doctor.specialty}</option>
                `).join('');
            
            // Set default date to today
            document.getElementById('labTestDate').value = new Date().toISOString().split('T')[0];
            
            openModal('addLabTestModal');
        }

        function saveNewLabTest(event) {
            event.preventDefault();
            
            const patientId = parseInt(document.getElementById('labTestPatient').value);
            const patient = adminData.patients.find(p => p.id === patientId);
            
            const doctorId = parseInt(document.getElementById('labTestRequestingDoctor').value);
            const doctor = adminData.doctors.find(d => d.id === doctorId);
            
            const newTest = {
                id: Math.max(...adminData.labTests.map(t => t.id)) + 1,
                patientId: patientId,
                patientName: patient.name,
                testType: document.getElementById('labTestType').value,
                requestingDoctor: doctor.name,
                date: document.getElementById('labTestDate').value,
                status: 'pending',
                results: '',
                notes: document.getElementById('labTestNotes').value
            };
            
            adminData.labTests.push(newTest);
            saveAdminData();
            
            closeModal('addLabTestModal');
            populateLabTestsTable(currentPage.labTests);
            showToast('Laboratory test added successfully!', 'success');
        }

        function viewLabTest(id) {
            const test = adminData.labTests.find(t => t.id === id);
            if (!test) return;
            
            const content = document.getElementById('labTestDetailsContent');
            content.innerHTML = `
                <div style="display: grid; gap: 20px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div>
                            <label style="display: block; color: var(--gray); font-size: 0.9rem; margin-bottom: 5px;">Patient</label>
                            <p style="font-weight: 600; font-size: 1.1rem;">${test.patientName}</p>
                        </div>
                        <div>
                            <label style="display: block; color: var(--gray); font-size: 0.9rem; margin-bottom: 5px;">Test Type</label>
                            <p style="font-weight: 600;">${test.testType}</p>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div>
                            <label style="display: block; color: var(--gray); font-size: 0.9rem; margin-bottom: 5px;">Requesting Doctor</label>
                            <p>${test.requestingDoctor}</p>
                        </div>
                        <div>
                            <label style="display: block; color: var(--gray); font-size: 0.9rem; margin-bottom: 5px;">Test Date</label>
                            <p>${formatDate(test.date)}</p>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div>
                            <label style="display: block; color: var(--gray); font-size: 0.9rem; margin-bottom: 5px;">Status</label>
                            <span class="status-badge status-${test.status}">${test.status}</span>
                        </div>
                        <div>
                            <label style="display: block; color: var(--gray); font-size: 0.9rem; margin-bottom: 5px;">Results</label>
                            <p style="font-weight: ${test.results ? '600' : 'normal'}">${test.results || 'Pending'}</p>
                        </div>
                    </div>
                    
                    ${test.notes ? `
                        <div>
                            <label style="display: block; color: var(--gray); font-size: 0.9rem; margin-bottom: 5px;">Notes</label>
                            <p>${test.notes}</p>
                        </div>
                    ` : ''}
                </div>
            `;
            
            const actions = document.getElementById('labTestActions');
            actions.innerHTML = `
                <button type="button" class="btn" onclick="closeModal('viewLabTestModal')">Close</button>
                ${test.status !== 'completed' ? `
                    <button type="button" class="btn btn-primary" onclick="openUpdateLabTestResults(${test.id})">
                        <i class="fas fa-edit"></i> Update Results
                    </button>
                ` : ''}
            `;
            
            openModal('viewLabTestModal');
        }

        function openUpdateLabTestResults(id) {
            const test = adminData.labTests.find(t => t.id === id);
            if (!test) return;
            
            const content = document.getElementById('updateLabTestResultsContent');
            content.innerHTML = `
                <input type="hidden" id="updateLabTestId" value="${test.id}">
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Test Status</label>
                        <select id="updateLabTestStatus" required>
                            <option value="pending" ${test.status === 'pending' ? 'selected' : ''}>Pending</option>
                            <option value="in-progress" ${test.status === 'in-progress' ? 'selected' : ''}>In Progress</option>
                            <option value="completed" ${test.status === 'completed' ? 'selected' : ''}>Completed</option>
                            <option value="cancelled" ${test.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Results</label>
                        <input type="text" id="updateLabTestResults" value="${test.results || ''}" placeholder="Enter test results">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Additional Notes</label>
                    <textarea id="updateLabTestNotes" rows="3">${test.notes || ''}</textarea>
                </div>
            `;
            
            closeModal('viewLabTestModal');
            setTimeout(() => {
                openModal('updateLabTestResultsModal');
            }, 300);
        }

        function saveLabTestResults(event) {
            event.preventDefault();
            
            const id = parseInt(document.getElementById('updateLabTestId').value);
            const testIndex = adminData.labTests.findIndex(t => t.id === id);
            
            if (testIndex === -1) return;
            
            adminData.labTests[testIndex] = {
                ...adminData.labTests[testIndex],
                status: document.getElementById('updateLabTestStatus').value,
                results: document.getElementById('updateLabTestResults').value,
                notes: document.getElementById('updateLabTestNotes').value
            };
            
            saveAdminData();
            populateLabTestsTable(currentPage.labTests);
            loadDashboardData();
            closeModal('updateLabTestResultsModal');
            showToast('Test results updated successfully!', 'success');
        }

        // Patient Management
        function loadPatientsData() {
            populatePatientsTable();
        }

        function populatePatientsTable(page = 1) {
            const container = document.getElementById('patientsTable');
            const pagination = document.getElementById('patientsPagination');
            
            // Calculate patient statistics
            const patientsWithStats = adminData.patients.map(patient => {
                const appointments = adminData.appointments.filter(a => a.patientId === patient.id);
                const labTests = adminData.labTests.filter(t => t.patientId === patient.id);
                
                return {
                    ...patient,
                    totalAppointments: appointments.length,
                    lastVisit: appointments.length > 0 ? 
                        appointments.sort((a, b) => new Date(b.date) - new Date(a.date))[0].date : 
                        'Never'
                };
            });
            
            // Calculate pagination
            const totalPages = Math.ceil(patientsWithStats.length / itemsPerPage);
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pagePatients = patientsWithStats.slice(startIndex, endIndex);
            
            // Update table
            container.innerHTML = pagePatients.map(patient => `
                <tr>
                    <td>#${patient.id.toString().padStart(3, '0')}</td>
                    <td>
                        <strong>${patient.name}</strong><br>
                        <small style="color: var(--gray);">${patient.address}</small>
                    </td>
                    <td>${patient.email}</td>
                    <td>${patient.phone}</td>
                    <td>${patient.age}</td>
                    <td>${patient.gender}</td>
                    <td>${formatDate(patient.lastVisit)}</td>
                    <td>${patient.totalAppointments}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-small btn-outline" onclick="viewPatient(${patient.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-small btn-primary" onclick="editPatient(${patient.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
            
            // Update pagination
            updatePagination(pagination, page, totalPages, 'patients');
        }

        function searchPatients() {
            const name = document.getElementById('patientNameSearch').value.toLowerCase();
            const email = document.getElementById('patientEmailSearch').value.toLowerCase();
            const phone = document.getElementById('patientPhoneSearch').value;
            
            const filteredPatients = adminData.patients.filter(patient => {
                if (name && !patient.name.toLowerCase().includes(name)) return false;
                if (email && !patient.email.toLowerCase().includes(email)) return false;
                if (phone && !patient.phone.includes(phone)) return false;
                return true;
            });
            
            const container = document.getElementById('patientsTable');
            container.innerHTML = filteredPatients.map(patient => {
                const appointments = adminData.appointments.filter(a => a.patientId === patient.id);
                
                return `
                    <tr>
                        <td>#${patient.id.toString().padStart(3, '0')}</td>
                        <td>
                            <strong>${patient.name}</strong><br>
                            <small style="color: var(--gray);">${patient.address}</small>
                        </td>
                        <td>${patient.email}</td>
                        <td>${patient.phone}</td>
                        <td>${patient.age}</td>
                        <td>${patient.gender}</td>
                        <td>${formatDate(patient.lastVisit)}</td>
                        <td>${appointments.length}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-small btn-outline" onclick="viewPatient(${patient.id})">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-small btn-primary" onclick="editPatient(${patient.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            document.getElementById('patientsPagination').innerHTML = '';
        }

        function quickSearchPatients() {
            const searchTerm = document.getElementById('patientQuickSearch').value.toLowerCase();
            
            if (!searchTerm) {
                populatePatientsTable(1);
                return;
            }
            
            const filteredPatients = adminData.patients.filter(patient => 
                patient.name.toLowerCase().includes(searchTerm) ||
                patient.email.toLowerCase().includes(searchTerm) ||
                patient.phone.includes(searchTerm)
            );
            
            const container = document.getElementById('patientsTable');
            container.innerHTML = filteredPatients.map(patient => {
                const appointments = adminData.appointments.filter(a => a.patientId === patient.id);
                
                return `
                    <tr>
                        <td>#${patient.id.toString().padStart(3, '0')}</td>
                        <td>
                            <strong>${patient.name}</strong><br>
                            <small style="color: var(--gray);">${patient.address}</small>
                        </td>
                        <td>${patient.email}</td>
                        <td>${patient.phone}</td>
                        <td>${patient.age}</td>
                        <td>${patient.gender}</td>
                        <td>${formatDate(patient.lastVisit)}</td>
                        <td>${appointments.length}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-small btn-outline" onclick="viewPatient(${patient.id})">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-small btn-primary" onclick="editPatient(${patient.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            document.getElementById('patientsPagination').innerHTML = '';
        }

        function viewPatient(id) {
            const patient = adminData.patients.find(p => p.id === id);
            if (!patient) return;
            
            const appointments = adminData.appointments.filter(a => a.patientId === id);
            const labTests = adminData.labTests.filter(t => t.patientId === id);
            
            const content = document.getElementById('patientDetailsContent');
            content.innerHTML = `
                <div style="display: grid; gap: 25px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div>
                            <label style="display: block; color: var(--gray); font-size: 0.9rem; margin-bottom: 5px;">Full Name</label>
                            <p style="font-weight: 600; font-size: 1.2rem;">${patient.name}</p>
                        </div>
                        <div>
                            <label style="display: block; color: var(--gray); font-size: 0.9rem; margin-bottom: 5px;">Contact</label>
                            <p>${patient.email}<br>${patient.phone}</p>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div>
                            <label style="display: block; color: var(--gray); font-size: 0.9rem; margin-bottom: 5px;">Age & Gender</label>
                            <p>${patient.age} years old, ${patient.gender}</p>
                        </div>
                        <div>
                            <label style="display: block; color: var(--gray); font-size: 0.9rem; margin-bottom: 5px;">Address</label>
                            <p>${patient.address}</p>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div>
                            <label style="display: block; color: var(--gray); font-size: 0.9rem; margin-bottom: 5px;">Total Appointments</label>
                            <p style="font-weight: 600; font-size: 1.1rem;">${appointments.length}</p>
                        </div>
                        <div>
                            <label style="display: block; color: var(--gray); font-size: 0.9rem; margin-bottom: 5px;">Total Lab Tests</label>
                            <p style="font-weight: 600; font-size: 1.1rem;">${labTests.length}</p>
                        </div>
                    </div>
                    
                    ${appointments.length > 0 ? `
                        <div>
                            <label style="display: block; color: var(--gray); font-size: 0.9rem; margin-bottom: 10px;">Recent Appointments</label>
                            <div style="background: #f8fafc; padding: 15px; border-radius: var(--radius); max-height: 200px; overflow-y: auto;">
                                ${appointments.slice(0, 5).map(appointment => `
                                    <div style="padding: 10px 0; border-bottom: 1px solid var(--gray-light);">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span style="font-weight: 600;">${formatDate(appointment.date)} at ${appointment.time}</span>
                                            <span class="status-badge status-${appointment.status}">${appointment.status}</span>
                                        </div>
                                        <div style="color: var(--gray); font-size: 0.9rem;">
                                            ${appointment.doctorName} â¢ ${appointment.type}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
            
            openModal('viewPatientModal');
        }

        // Doctor Management
        function loadDoctorsData() {
            populateDoctorsTable();
        }

        function populateDoctorsTable() {
            const container = document.getElementById('doctorsTable');
            
            const doctorsWithStats = adminData.doctors.map(doctor => {
                const appointments = adminData.appointments.filter(a => a.doctorId === doctor.id);
                const pendingAppointments = appointments.filter(a => a.status === 'pending').length;
                const completedAppointments = appointments.filter(a => a.status === 'completed').length;
                
                return {
                    ...doctor,
                    totalAppointments: appointments.length,
                    pendingAppointments: pendingAppointments,
                    completedAppointments: completedAppointments
                };
            });
            
            container.innerHTML = doctorsWithStats.map(doctor => `
                <tr>
                    <td>#${doctor.id.toString().padStart(3, '0')}</td>
                    <td>
                        <strong>${doctor.name}</strong><br>
                        <small style="color: var(--gray);">${doctor.email}</small>
                    </td>
                    <td>${doctor.specialty}</td>
                    <td>${doctor.phone}</td>
                    <td>
                        <div style="font-size: 0.9rem;">
                            <div>Weekdays: ${doctor.weekdaySchedule}</div>
                            ${doctor.sundaySchedule !== 'Not Available' ? `<div>Sunday: ${doctor.sundaySchedule}</div>` : ''}
                        </div>
                    </td>
                    <td>${doctor.availableSlots}</td>
                    <td>
                        <span class="status-badge ${doctor.status === 'available' ? 'status-confirmed' : 'status-cancelled'}">
                            ${doctor.status}
                        </span>
                    </td>
                    <td>
                        <div style="font-size: 0.9rem;">
                            <div>Total: ${doctor.totalAppointments}</div>
                            <div>Pending: ${doctor.pendingAppointments}</div>
                            <div>Completed: ${doctor.completedAppointments}</div>
                        </div>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-small btn-outline" onclick="editDoctor(${doctor.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-small btn-danger" onclick="deleteDoctor(${doctor.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function filterDoctors() {
            const name = document.getElementById('doctorNameSearch').value.toLowerCase();
            const specialty = document.getElementById('doctorSpecialtyFilter').value;
            const availability = document.getElementById('doctorAvailabilityFilter').value;
            
            const filteredDoctors = adminData.doctors.filter(doctor => {
                if (name && !doctor.name.toLowerCase().includes(name)) return false;
                if (specialty && doctor.specialty !== specialty) return false;
                if (availability === 'available' && doctor.status !== 'available') return false;
                if (availability === 'unavailable' && doctor.status === 'available') return false;
                return true;
            });
            
            const container = document.getElementById('doctorsTable');
            container.innerHTML = filteredDoctors.map(doctor => {
                const appointments = adminData.appointments.filter(a => a.doctorId === doctor.id);
                
                return `
                    <tr>
                        <td>#${doctor.id.toString().padStart(3, '0')}</td>
                        <td>
                            <strong>${doctor.name}</strong><br>
                            <small style="color: var(--gray);">${doctor.email}</small>
                        </td>
                        <td>${doctor.specialty}</td>
                        <td>${doctor.phone}</td>
                        <td>
                            <div style="font-size: 0.9rem;">
                                <div>Weekdays: ${doctor.weekdaySchedule}</div>
                                ${doctor.sundaySchedule !== 'Not Available' ? `<div>Sunday: ${doctor.sundaySchedule}</div>` : ''}
                            </div>
                        </td>
                        <td>${doctor.availableSlots}</td>
                        <td>
                            <span class="status-badge ${doctor.status === 'available' ? 'status-confirmed' : 'status-cancelled'}">
                                ${doctor.status}
                            </span>
                        </td>
                        <td>
                            <div style="font-size: 0.9rem;">
                                <div>Total: ${appointments.length}</div>
                                <div>Pending: ${appointments.filter(a => a.status === 'pending').length}</div>
                                <div>Completed: ${appointments.filter(a => a.status === 'completed').length}</div>
                            </div>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-small btn-outline" onclick="editDoctor(${doctor.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-small btn-danger" onclick="deleteDoctor(${doctor.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function quickSearchDoctors() {
            const searchTerm = document.getElementById('doctorQuickSearch').value.toLowerCase();
            
            if (!searchTerm) {
                populateDoctorsTable();
                return;
            }
            
            const filteredDoctors = adminData.doctors.filter(doctor => 
                doctor.name.toLowerCase().includes(searchTerm) ||
                doctor.specialty.toLowerCase().includes(searchTerm) ||
                doctor.email.toLowerCase().includes(searchTerm)
            );
            
            const container = document.getElementById('doctorsTable');
            container.innerHTML = filteredDoctors.map(doctor => {
                const appointments = adminData.appointments.filter(a => a.doctorId === doctor.id);
                
                return `
                    <tr>
                        <td>#${doctor.id.toString().padStart(3, '0')}</td>
                        <td>
                            <strong>${doctor.name}</strong><br>
                            <small style="color: var(--gray);">${doctor.email}</small>
                        </td>
                        <td>${doctor.specialty}</td>
                        <td>${doctor.phone}</td>
                        <td>
                            <div style="font-size: 0.9rem;">
                                <div>Weekdays: ${doctor.weekdaySchedule}</div>
                                ${doctor.sundaySchedule !== 'Not Available' ? `<div>Sunday: ${doctor.sundaySchedule}</div>` : ''}
                            </div>
                        </td>
                        <td>${doctor.availableSlots}</td>
                        <td>
                            <span class="status-badge ${doctor.status === 'available' ? 'status-confirmed' : 'status-cancelled'}">
                                ${doctor.status}
                            </span>
                        </td>
                        <td>
                            <div style="font-size: 0.9rem;">
                                <div>Total: ${appointments.length}</div>
                                <div>Pending: ${appointments.filter(a => a.status === 'pending').length}</div>
                                <div>Completed: ${appointments.filter(a => a.status === 'completed').length}</div>
                            </div>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-small btn-outline" onclick="editDoctor(${doctor.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-small btn-danger" onclick="deleteDoctor(${doctor.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function openAddDoctorModal() {
            openModal('addDoctorModal');
        }

        function saveNewDoctor(event) {
            event.preventDefault();
            
            const newDoctor = {
                id: Math.max(...adminData.doctors.map(d => d.id)) + 1,
                name: document.getElementById('doctorFullName').value,
                specialty: document.getElementById('doctorSpecialty').value,
                email: document.getElementById('doctorEmail').value,
                phone: document.getElementById('doctorPhone').value,
                weekdaySchedule: document.getElementById('doctorWeekdaySchedule').value,
                sundaySchedule: document.getElementById('doctorSundaySchedule').value || 'Not Available',
                availableSlots: parseInt(document.getElementById('doctorAvailableSlots').value),
                status: document.getElementById('doctorStatus').value,
                qualifications: document.getElementById('doctorQualifications').value
            };
            
            adminData.doctors.push(newDoctor);
            saveAdminData();
            
            closeModal('addDoctorModal');
            populateDoctorsTable();
            populateDoctorDropdowns();
            showToast('Doctor added successfully!', 'success');
        }

        function editDoctor(id) {
            const doctor = adminData.doctors.find(d => d.id === id);
            if (!doctor) return;
            
            const content = document.getElementById('editDoctorFormContent');
            content.innerHTML = `
                <input type="hidden" id="editDoctorId" value="${doctor.id}">
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="editDoctorName" value="${doctor.name}" required>
                    </div>
                    <div class="form-group">
                        <label>Specialty</label>
                        <select id="editDoctorSpecialty" required>
                            <option value="General Medicine" ${doctor.specialty === 'General Medicine' ? 'selected' : ''}>General Medicine</option>
                            <option value="Pediatrics" ${doctor.specialty === 'Pediatrics' ? 'selected' : ''}>Pediatrics</option>
                            <option value="Gynecology" ${doctor.specialty === 'Gynecology' ? 'selected' : ''}>Gynecology</option>
                            <option value="Ophthalmology" ${doctor.specialty === 'Ophthalmology' ? 'selected' : ''}>Ophthalmology</option>
                            <option value="Surgery" ${doctor.specialty === 'Surgery' ? 'selected' : ''}>Surgery</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="editDoctorEmail" value="${doctor.email}" required>
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" id="editDoctorPhone" value="${doctor.phone}" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Weekday Schedule</label>
                        <input type="text" id="editDoctorWeekdaySchedule" value="${doctor.weekdaySchedule}" required>
                    </div>
                    <div class="form-group">
                        <label>Sunday Schedule</label>
                        <input type="text" id="editDoctorSundaySchedule" value="${doctor.sundaySchedule}">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Available Slots per Day</label>
                        <input type="number" id="editDoctorAvailableSlots" value="${doctor.availableSlots}" min="1" max="20" required>
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="editDoctorStatus" required>
                            <option value="available" ${doctor.status === 'available' ? 'selected' : ''}>Available</option>
                            <option value="unavailable" ${doctor.status === 'unavailable' ? 'selected' : ''}>Unavailable</option>
                            <option value="on-leave" ${doctor.status === 'on-leave' ? 'selected' : ''}>On Leave</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Qualifications</label>
                    <textarea id="editDoctorQualifications" rows="3">${doctor.qualifications || ''}</textarea>
                </div>
            `;
            
            openModal('editDoctorModal');
        }

        function updateDoctor(event) {
            event.preventDefault();
            
            const id = parseInt(document.getElementById('editDoctorId').value);
            const doctorIndex = adminData.doctors.findIndex(d => d.id === id);
            
            if (doctorIndex === -1) return;
            
            adminData.doctors[doctorIndex] = {
                ...adminData.doctors[doctorIndex],
                name: document.getElementById('editDoctorName').value,
                specialty: document.getElementById('editDoctorSpecialty').value,
                email: document.getElementById('editDoctorEmail').value,
                phone: document.getElementById('editDoctorPhone').value,
                weekdaySchedule: document.getElementById('editDoctorWeekdaySchedule').value,
                sundaySchedule: document.getElementById('editDoctorSundaySchedule').value || 'Not Available',
                availableSlots: parseInt(document.getElementById('editDoctorAvailableSlots').value),
                status: document.getElementById('editDoctorStatus').value,
                qualifications: document.getElementById('editDoctorQualifications').value
            };
            
            // Update all appointments with this doctor's name
            adminData.appointments.forEach((appointment, index) => {
                if (appointment.doctorId === id) {
                    adminData.appointments[index].doctorName = adminData.doctors[doctorIndex].name;
                }
            });
            
            saveAdminData();
            populateDoctorsTable();
            populateDoctorDropdowns();
            closeModal('editDoctorModal');
            showToast('Doctor information updated successfully!', 'success');
        }

        function deleteDoctor(id) {
            if (confirm('Are you sure you want to delete this doctor? This will affect existing appointments.')) {
                adminData.doctors = adminData.doctors.filter(d => d.id !== id);
                saveAdminData();
                populateDoctorsTable();
                populateDoctorDropdowns();
                showToast('Doctor deleted successfully!', 'success');
            }
        }

        function editSlideshowImage(id) {
            const image = adminData.slideshowImages.find(i => i.id === id);
            if (!image) return;
            
            const content = document.getElementById('editSlideshowImageContent');
            content.innerHTML = `
                <input type="hidden" id="editSlideshowImageId" value="${image.id}">
                
                <div class="form-group">
                    <label>Image ${image.type === 'uploaded' ? '(Cannot change uploaded image)' : 'URL'}</label>
                    <input type="${image.type === 'uploaded' ? 'text' : 'url'}" 
                           id="editSlideshowImageUrl" 
                           value="${image.url}" 
                           ${image.type === 'uploaded' ? 'readonly' : 'required'}>
                    ${image.type === 'uploaded' ? 
                        '<small style="color: var(--gray);">To change image, delete and upload new one</small>' : ''}
                </div>
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="editSlideshowImageTitle" value="${image.title}" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="editSlideshowImageDescription" required>${image.description}</textarea>
                </div>
            `;
            
            openModal('editSlideshowImageModal');
        }

        function updateSlideshowImage(event) {
            event.preventDefault();
            
            const id = parseInt(document.getElementById('editSlideshowImageId').value);
            const imageIndex = adminData.slideshowImages.findIndex(i => i.id === id);
            
            if (imageIndex === -1) return;
            
            const image = adminData.slideshowImages[imageIndex];
            
            // Only update URL for URL-based images
            if (image.type === 'url') {
                image.url = document.getElementById('editSlideshowImageUrl').value;
            }
            
            image.title = document.getElementById('editSlideshowImageTitle').value;
            image.description = document.getElementById('editSlideshowImageDescription').value;
            
            saveAdminData();
            
            // Update user interface slideshow
            updateUserInterfaceSlideshow();
            
            loadSlideshowImages();
            closeModal('editSlideshowImageModal');
            showToast('Slideshow image updated successfully!', 'success');
        }

        function deleteSlideshowImage(id) {
            if (confirm('Are you sure you want to delete this slideshow image?')) {
                adminData.slideshowImages = adminData.slideshowImages.filter(i => i.id !== id);
                saveAdminData();
                
                // Update user interface slideshow
                updateUserInterfaceSlideshow();
                
                loadSlideshowImages();
                showToast('Slideshow image deleted successfully!', 'success');
            }
        }

        function setAsFeatured(id) {
            const image = adminData.slideshowImages.find(i => i.id === id);
            if (!image) return;
            
            // Move to beginning of array
            adminData.slideshowImages = adminData.slideshowImages.filter(i => i.id !== id);
            adminData.slideshowImages.unshift(image);
            
            saveAdminData();
            
            // Update user interface slideshow
            updateUserInterfaceSlideshow();
            
            loadSlideshowImages();
            showToast('Image set as featured!', 'success');
        }

        // Reports
        function toggleReportOptions() {
            const reportType = document.getElementById('reportType').value;
            const doctorFilterContainer = document.getElementById('reportDoctorFilterContainer');
            
            if (reportType === 'appointments' || reportType === 'lab_tests') {
                doctorFilterContainer.style.display = 'block';
            } else {
                doctorFilterContainer.style.display = 'none';
            }
        }

        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const dateFrom = document.getElementById('reportDateFrom').value;
            const dateTo = document.getElementById('reportDateTo').value;
            const doctorId = document.getElementById('reportDoctorFilter').value;
            
            if (!dateFrom || !dateTo) {
                showToast('Please select date range', 'error');
                return;
            }
            
            let reportData = [];
            let reportTitle = '';
            
            switch(reportType) {
                case 'appointments':
                    reportTitle = 'Appointments Report';
                    reportData = generateAppointmentsReport(dateFrom, dateTo, doctorId);
                    break;
                case 'lab_tests':
                    reportTitle = 'Laboratory Tests Report';
                    reportData = generateLabTestsReport(dateFrom, dateTo, doctorId);
                    break;
                case 'revenue':
                    reportTitle = 'Revenue Report';
                    reportData = generateRevenueReport(dateFrom, dateTo);
                    break;
                case 'patients':
                    reportTitle = 'Patient Statistics Report';
                    reportData = generatePatientStatisticsReport(dateFrom, dateTo);
                    break;
            }
            
            displayReport(reportTitle, reportData);
            document.getElementById('exportReportBtn').style.display = 'inline-block';
        }

        function generateAppointmentsReport(dateFrom, dateTo, doctorId) {
            let filteredAppointments = adminData.appointments.filter(appointment => {
                const appDate = new Date(appointment.date);
                return appDate >= new Date(dateFrom) && appDate <= new Date(dateTo);
            });
            
            if (doctorId) {
                filteredAppointments = filteredAppointments.filter(a => a.doctorId === parseInt(doctorId));
            }
            
            // Group by status
            const statusGroups = {};
            filteredAppointments.forEach(appointment => {
                if (!statusGroups[appointment.status]) {
                    statusGroups[appointment.status] = 0;
                }
                statusGroups[appointment.status]++;
            });
            
            // Group by doctor
            const doctorGroups = {};
            filteredAppointments.forEach(appointment => {
                if (!doctorGroups[appointment.doctorName]) {
                    doctorGroups[appointment.doctorName] = 0;
                }
                doctorGroups[appointment.doctorName]++;
            });
            
            return {
                summary: {
                    total: filteredAppointments.length,
                    byStatus: statusGroups,
                    byDoctor: doctorGroups
                },
                details: filteredAppointments
            };
        }

        function generateLabTestsReport(dateFrom, dateTo, doctorId) {
            let filteredTests = adminData.labTests.filter(test => {
                const testDate = new Date(test.date);
                return testDate >= new Date(dateFrom) && testDate <= new Date(dateTo);
            });
            
            if (doctorId) {
                const doctor = adminData.doctors.find(d => d.id === parseInt(doctorId));
                if (doctor) {
                    filteredTests = filteredTests.filter(t => t.requestingDoctor === doctor.name);
                }
            }
            
            // Group by type
            const typeGroups = {};
            filteredTests.forEach(test => {
                if (!typeGroups[test.testType]) {
                    typeGroups[test.testType] = 0;
                }
                typeGroups[test.testType]++;
            });
            
            // Group by status
            const statusGroups = {};
            filteredTests.forEach(test => {
                if (!statusGroups[test.status]) {
                    statusGroups[test.status] = 0;
                }
                statusGroups[test.status]++;
            });
            
            return {
                summary: {
                    total: filteredTests.length,
                    byType: typeGroups,
                    byStatus: statusGroups
                },
                details: filteredTests
            };
        }

        function generateRevenueReport(dateFrom, dateTo) {
            // Mock revenue data - in a real system, this would come from payments
            const appointments = adminData.appointments.filter(appointment => {
                const appDate = new Date(appointment.date);
                return appDate >= new Date(dateFrom) && appDate <= new Date(dateTo);
            });
            
            // Calculate revenue based on appointment type
            const revenueByType = {
                general: 0,
                followup: 0,
                lab: 0,
                emergency: 0
            };
            
            const prices = {
                general: 500,
                followup: 300,
                lab: 1000,
                emergency: 1500
            };
            
            appointments.forEach(appointment => {
                if (prices[appointment.type]) {
                    revenueByType[appointment.type] += prices[appointment.type];
                }
            });
            
            const totalRevenue = Object.values(revenueByType).reduce((a, b) => a + b, 0);
            
            return {
                summary: {
                    totalRevenue: totalRevenue,
                    revenueByType: revenueByType,
                    totalAppointments: appointments.length
                },
                details: appointments.map(appointment => ({
                    ...appointment,
                    revenue: prices[appointment.type] || 0
                }))
            };
        }

        function generatePatientStatisticsReport(dateFrom, dateTo) {
            const appointments = adminData.appointments.filter(appointment => {
                const appDate = new Date(appointment.date);
                return appDate >= new Date(dateFrom) && appDate <= new Date(dateTo);
            });
            
            // Count unique patients
            const uniquePatientIds = [...new Set(appointments.map(a => a.patientId))];
            
            // Group by age
            const ageGroups = {
                '0-18': 0,
                '19-35': 0,
                '36-50': 0,
                '51-65': 0,
                '65+': 0
            };
            
            // Group by gender
            const genderGroups = {
                Male: 0,
                Female: 0,
                Other: 0
            };
            
            uniquePatientIds.forEach(patientId => {
                const patient = adminData.patients.find(p => p.id === patientId);
                if (patient) {
                    // Age group
                    if (patient.age <= 18) ageGroups['0-18']++;
                    else if (patient.age <= 35) ageGroups['19-35']++;
                    else if (patient.age <= 50) ageGroups['36-50']++;
                    else if (patient.age <= 65) ageGroups['51-65']++;
                    else ageGroups['65+']++;
                    
                    // Gender
                    if (genderGroups[patient.gender] !== undefined) {
                        genderGroups[patient.gender]++;
                    } else {
                        genderGroups['Other']++;
                    }
                }
            });
            
            return {
                summary: {
                    totalPatients: uniquePatientIds.length,
                    byAge: ageGroups,
                    byGender: genderGroups,
                    totalAppointments: appointments.length
                },
                details: uniquePatientIds.map(patientId => {
                    const patient = adminData.patients.find(p => p.id === patientId);
                    const patientAppointments = appointments.filter(a => a.patientId === patientId);
                    
                    return {
                        patient: patient,
                        appointmentCount: patientAppointments.length,
                        lastAppointment: patientAppointments.length > 0 ? 
                            patientAppointments.sort((a, b) => new Date(b.date) - new Date(a.date))[0].date : 
                            null
                    };
                })
            };
        }

        function displayReport(title, data) {
            document.getElementById('reportTitle').textContent = title;
            const table = document.getElementById('reportTable');
            
            let html = '';
            
            if (title.includes('Appointments')) {
                html = `
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Patient</th>
                            <th>Doctor</th>
                            <th>Date</th>
                            <th>Time</th>
                            <th>Type</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${data.details.map(item => `
                            <tr>
                                <td>#${item.id.toString().padStart(3, '0')}</td>
                                <td>${item.patientName}</td>
                                <td>${item.doctorName}</td>
                                <td>${formatDate(item.date)}</td>
                                <td>${item.time}</td>
                                <td>${item.type}</td>
                                <td><span class="status-badge status-${item.status}">${item.status}</span></td>
                            </tr>
                        `).join('')}
                    </tbody>
                `;
            } else if (title.includes('Laboratory')) {
                html = `
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Patient</th>
                            <th>Test Type</th>
                            <th>Requesting Doctor</th>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Results</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${data.details.map(item => `
                            <tr>
                                <td>#${item.id.toString().padStart(3, '0')}</td>
                                <td>${item.patientName}</td>
                                <td>${item.testType}</td>
                                <td>${item.requestingDoctor}</td>
                                <td>${formatDate(item.date)}</td>
                                <td><span class="status-badge status-${item.status}">${item.status}</span></td>
                                <td>${item.results || 'Pending'}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                `;
            } else if (title.includes('Revenue')) {
                html = `
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Patient</th>
                            <th>Service Type</th>
                            <th>Date</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${data.details.map(item => `
                            <tr>
                                <td>#${item.id.toString().padStart(3, '0')}</td>
                                <td>${item.patientName}</td>
                                <td>${item.type}</td>
                                <td>${formatDate(item.date)}</td>
                                <td>â±${item.revenue.toLocaleString()}</td>
                            </tr>
                        `).join('')}
                        <tr style="background-color: var(--primary-light);">
                            <td colspan="4" style="text-align: right; font-weight: 600;">Total Revenue:</td>
                            <td style="font-weight: 600;">â±${data.summary.totalRevenue.toLocaleString()}</td>
                        </tr>
                    </tbody>
                `;
            } else if (title.includes('Patient')) {
                html = `
                    <thead>
                        <tr>
                            <th>Patient ID</th>
                            <th>Name</th>
                            <th>Age</th>
                            <th>Gender</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Appointments</th>
                            <th>Last Visit</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${data.details.map(item => `
                            <tr>
                                <td>#${item.patient.id.toString().padStart(3, '0')}</td>
                                <td>${item.patient.name}</td>
                                <td>${item.patient.age}</td>
                                <td>${item.patient.gender}</td>
                                <td>${item.patient.email}</td>
                                <td>${item.patient.phone}</td>
                                <td>${item.appointmentCount}</td>
                                <td>${item.lastAppointment ? formatDate(item.lastAppointment) : 'Never'}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                `;
            }
            
            table.innerHTML = html;
            document.getElementById('reportResults').classList.remove('hidden');
        }

        function exportReport() {
            const reportType = document.getElementById('reportType').value;
            
            switch(reportType) {
                case 'appointments':
                    exportAppointmentsCSV();
                    break;
                case 'lab_tests':
                    exportLabTestsCSV();
                    break;
                case 'revenue':
                    exportRevenueCSV();
                    break;
                case 'patients':
                    exportPatientsCSV();
                    break;
            }
        }

        // Settings
        function loadSettings() {
            // Load current settings into form
            const settings = adminData.settings;
            
            // General settings
            document.getElementById('clinicName').value = settings.clinicName;
            document.getElementById('clinicHoursWeekdays').value = settings.clinicHoursWeekdays;
            document.getElementById('clinicHoursSunday').value = settings.clinicHoursSunday;
            document.getElementById('clinicPhone').value = settings.clinicPhone;
            document.getElementById('clinicEmail').value = settings.clinicEmail;
            document.getElementById('appointmentSlotDuration').value = settings.appointmentSlotDuration;
            
            // Security settings
            document.getElementById('sessionTimeout').value = settings.sessionTimeout;
            document.getElementById('maxLoginAttempts').value = settings.maxLoginAttempts;
            document.getElementById('passwordExpiry').value = settings.passwordExpiry;
            
            // Notification settings
            document.getElementById('emailNotifications').checked = settings.emailNotifications;
            document.getElementById('smsNotifications').checked = settings.smsNotifications;
            document.getElementById('reminderHours').value = settings.reminderHours;
            
            // Backup settings
            document.getElementById('backupFrequency').value = settings.backupFrequency;
            document.getElementById('backupRetention').value = settings.backupRetention;
        }

        function showSettingsTab(tab) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(el => {
                el.classList.remove('active');
            });
            
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.target.classList.add('active');
            
            // Show selected tab
            document.getElementById(`${tab}Settings`).classList.add('active');
        }

        function saveGeneralSettings() {
            adminData.settings.clinicName = document.getElementById('clinicName').value;
            adminData.settings.clinicHoursWeekdays = document.getElementById('clinicHoursWeekdays').value;
            adminData.settings.clinicHoursSunday = document.getElementById('clinicHoursSunday').value;
            adminData.settings.clinicPhone = document.getElementById('clinicPhone').value;
            adminData.settings.clinicEmail = document.getElementById('clinicEmail').value;
            adminData.settings.appointmentSlotDuration = parseInt(document.getElementById('appointmentSlotDuration').value);
            
            saveAdminData();
            showToast('General settings saved successfully!', 'success');
        }

        function saveSecuritySettings() {
            adminData.settings.sessionTimeout = parseInt(document.getElementById('sessionTimeout').value);
            adminData.settings.maxLoginAttempts = parseInt(document.getElementById('maxLoginAttempts').value);
            adminData.settings.passwordExpiry = parseInt(document.getElementById('passwordExpiry').value);
            
            saveAdminData();
            showToast('Security settings saved successfully!', 'success');
        }

        function saveNotificationSettings() {
            adminData.settings.emailNotifications = document.getElementById('emailNotifications').checked;
            adminData.settings.smsNotifications = document.getElementById('smsNotifications').checked;
            adminData.settings.reminderHours = parseInt(document.getElementById('reminderHours').value);
            
            saveAdminData();
            showToast('Notification settings saved successfully!', 'success');
        }

        function saveBackupSettings() {
            adminData.settings.backupFrequency = document.getElementById('backupFrequency').value;
            adminData.settings.backupRetention = parseInt(document.getElementById('backupRetention').value);
            
            saveAdminData();
            showToast('Backup settings saved successfully!', 'success');
        }

        function createBackup() {
            // In a real system, this would create a database backup
            const backupData = {
                timestamp: new Date().toISOString(),
                data: adminData
            };
            
            // Save to localStorage as backup
            localStorage.setItem('adminBackup_' + new Date().getTime(), JSON.stringify(backupData));
            
            showToast('Backup created successfully!', 'success');
        }

        // Utility Functions
        function formatDate(dateString) {
            if (!dateString || dateString === 'Never') return dateString;
            
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        function populateDoctorDropdowns() {
            const doctorOptions = adminData.doctors.map(doctor => 
                `<option value="${doctor.id}">${doctor.name} - ${doctor.specialty}</option>`
            ).join('');
            
            // Update all doctor dropdowns
            const dropdowns = [
                'appointmentDoctorFilter',
                'labTestDoctorFilter',
                'reportDoctorFilter'
            ];
            
            dropdowns.forEach(dropdownId => {
                const dropdown = document.getElementById(dropdownId);
                if (dropdown) {
                    dropdown.innerHTML = '<option value="">All Doctors</option>' + doctorOptions;
                }
            });
        }

        function populateAppointmentFilters() {
            // Already populated by populateDoctorDropdowns
        }

        function populateLabTestFilters() {
            // Already populated by populateDoctorDropdowns
        }

        function updatePagination(container, currentPage, totalPages, type) {
            if (totalPages <= 1) {
                container.innerHTML = '';
                return;
            }
            
            let html = '';
            
            // Previous button
            html += `
                <button class="pagination-btn" ${currentPage === 1 ? 'disabled' : ''} 
                        onclick="changePage('${type}', ${currentPage - 1})">
                    <i class="fas fa-chevron-left"></i>
                </button>
            `;
            
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
                    html += `
                        <button class="pagination-btn ${i === currentPage ? 'active' : ''}" 
                                onclick="changePage('${type}', ${i})">
                            ${i}
                        </button>
                    `;
                } else if (i === currentPage - 2 || i === currentPage + 2) {
                    html += `<span>...</span>`;
                }
            }
            
            // Next button
            html += `
                <button class="pagination-btn" ${currentPage === totalPages ? 'disabled' : ''} 
                        onclick="changePage('${type}', ${currentPage + 1})">
                    <i class="fas fa-chevron-right"></i>
                </button>
            `;
            
            container.innerHTML = html;
        }

        function changePage(type, page) {
            currentPage[type] = page;
            
            switch(type) {
                case 'appointments':
                    populateAppointmentsTable(page);
                    break;
                case 'labTests':
                    populateLabTestsTable(page);
                    break;
                case 'patients':
                    populatePatientsTable(page);
                    break;
            }
        }

        // Export Functions
        function exportAppointmentsCSV() {
            const filteredAppointments = filterAppointmentsData();
            exportToCSV(filteredAppointments, 'appointments');
        }

        function exportLabTestsCSV() {
            const filteredTests = filterLabTestsData();
            exportToCSV(filteredTests, 'lab_tests');
        }

        function exportPatientsCSV() {
            exportToCSV(adminData.patients, 'patients');
        }

        function exportRevenueCSV() {
            const dateFrom = document.getElementById('reportDateFrom').value;
            const dateTo = document.getElementById('reportDateTo').value;
            
            let filteredAppointments = adminData.appointments.filter(appointment => {
                const appDate = new Date(appointment.date);
                return appDate >= new Date(dateFrom) && appDate <= new Date(dateTo);
            });
            
            const prices = {
                general: 500,
                followup: 300,
                lab: 1000,
                emergency: 1500
            };
            
            const revenueData = filteredAppointments.map(appointment => ({
                ...appointment,
                revenue: prices[appointment.type] || 0
            }));
            
            exportToCSV(revenueData, 'revenue');
        }

        function exportReportCSV() {
            const reportType = document.getElementById('reportType').value;
            
            switch(reportType) {
                case 'appointments':
                    exportAppointmentsCSV();
                    break;
                case 'lab_tests':
                    exportLabTestsCSV();
                    break;
                case 'revenue':
                    exportRevenueCSV();
                    break;
                case 'patients':
                    exportPatientsCSV();
                    break;
            }
        }

        function exportToCSV(data, filename) {
            if (data.length === 0) {
                showToast('No data to export', 'warning');
                return;
            }
            
            // Convert data to CSV
            const headers = Object.keys(data[0]);
            const csvRows = [];
            
            // Add headers
            csvRows.push(headers.join(','));
            
            // Add data rows
            data.forEach(row => {
                const values = headers.map(header => {
                    const value = row[header];
                    // Handle values that might contain commas
                    return typeof value === 'string' ? `"${value}"` : value;
                });
                csvRows.push(values.join(','));
            });
            
            // Create CSV file
            const csvString = csvRows.join('\n');
            const blob = new Blob([csvString], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            
            // Create download link
            const a = document.createElement('a');
            a.href = url;
            a.download = `${filename}_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            showToast(`Exported ${data.length} records to CSV`, 'success');
        }

        function printAppointments() {
            window.print();
        }

        function printLabTests() {
            window.print();
        }

        function printReport() {
            window.print();
        }

        // Modal Functions
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Notification Functions
        function updateNotifications() {
            const unreadCount = adminData.notifications.filter(n => !n.read).length;
            document.getElementById('notificationCount').textContent = unreadCount;
        }

        function showNotifications() {
            const container = document.getElementById('notificationsList');
            
            container.innerHTML = adminData.notifications.map(notification => `
                <div style="padding: 15px; border-bottom: 1px solid var(--gray-light); 
                           background: ${notification.read ? 'transparent' : 'var(--primary-light)'};">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div>
                            <p style="font-weight: ${notification.read ? 'normal' : '600'}; margin-bottom: 5px;">
                                ${notification.message}
                            </p>
                            <small style="color: var(--gray);">${notification.time}</small>
                        </div>
                        ${!notification.read ? `
                            <button class="btn btn-small" onclick="markNotificationAsRead(${notification.id})">
                                <i class="fas fa-check"></i>
                            </button>
                        ` : ''}
                    </div>
                </div>
            `).join('');
            
            openModal('notificationsModal');
        }

        function markNotificationAsRead(id) {
            const notificationIndex = adminData.notifications.findIndex(n => n.id === id);
            if (notificationIndex !== -1) {
                adminData.notifications[notificationIndex].read = true;
                saveAdminData();
                updateNotifications();
                showNotifications();
            }
        }

        // System Functions
        function refreshData() {
            showToast('Refreshing data...', 'info');
            
            // Simulate data refresh
            setTimeout(() => {
                switch(currentSection) {
                    case 'dashboard':
                        loadDashboardData();
                        break;
                    case 'appointments':
                        loadAppointmentsData();
                        break;
                    case 'labTests':
                        loadLabTestsData();
                        break;
                    case 'patients':
                        loadPatientsData();
                        break;
                    case 'doctors':
                        loadDoctorsData();
                        break;
                    case 'slideshow':
                        loadSlideshowImages();
                        break;
                }
                showToast('Data refreshed successfully!', 'success');
            }, 500);
        }

        function saveAdminData() {
            localStorage.setItem('adminAppointments', JSON.stringify(adminData.appointments));
            localStorage.setItem('adminLabTests', JSON.stringify(adminData.labTests));
            localStorage.setItem('adminPatients', JSON.stringify(adminData.patients));
            localStorage.setItem('adminDoctors', JSON.stringify(adminData.doctors));
            localStorage.setItem('adminSlideshowImages', JSON.stringify(adminData.slideshowImages));
            localStorage.setItem('adminNotifications', JSON.stringify(adminData.notifications));
            localStorage.setItem('adminSettings', JSON.stringify(adminData.settings));
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type}`;
            
            // Set icon
            let icon = 'fas fa-info-circle';
            if (type === 'success') icon = 'fas fa-check-circle';
            if (type === 'error') icon = 'fas fa-exclamation-circle';
            if (type === 'warning') icon = 'fas fa-exclamation-triangle';
            
            toast.innerHTML = `<i class="${icon}"></i> ${message}`;
            
            // Show toast
            setTimeout(() => {
                toast.classList.remove('hidden');
            }, 10);
            
            // Hide after 3 seconds
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);ww
        }

        // Initialize when page loads
        window.onload = initAdminDashboard;
    </script>
</body>
</html>